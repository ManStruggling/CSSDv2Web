(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-23662699"],{"03af":function(t,a,e){"use strict";var i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"basic_package_box"},[e("div",{staticClass:"package_box"},[e("h3",[t.selectIsFix?t._e():e("el-select",{staticClass:"green24x13",on:{change:t.packageClassChange},model:{value:t.packageBoxClassSelect,callback:function(a){t.packageBoxClassSelect=a},expression:"packageBoxClassSelect"}},[e("el-option",{attrs:{label:"全部",value:"all"}}),e("el-option",{attrs:{label:"追溯的无菌包",value:"追溯的无菌包"}}),e("el-option",{attrs:{label:"高水平消毒包",value:"高水平消毒包"}}),e("el-option",{attrs:{label:"追溯的辅料包",value:"追溯的辅料包",disabled:t.optionIsFix}})],1),e("el-input",{style:t.selectIsFix?"width:100%":"",attrs:{placeholder:"请输入拼音简码"},on:{input:t.packageSearch},model:{value:t.searchShortCode,callback:function(a){t.searchShortCode=a},expression:"searchShortCode"}})],1),e("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.packageList,"tooltip-effect":"dark","max-height":"300",width:"400","row-key":t.getRowKeys},on:{"row-click":t.handleRowClick,"selection-change":t.handleSelectionChange}},[e("el-table-column",{attrs:{type:"selection",width:"55","reserve-selection":!0}}),e("el-table-column",{staticClass:"product_name",attrs:{prop:"ProductName",label:"包名称",width:"201",sortable:"","sort-by":"ProductShortCode","show-overflow-tooltip":!0}}),e("el-table-column",{attrs:{prop:"ProvideSubClinicName",label:"所属科室",sortable:"","sort-by":"ProvideSubClinicShortCode",width:"160"},scopedSlots:t._u([{key:"default",fn:function(a){return[a.row.IsCommonProduct?e("el-select",{staticClass:"green18x10",attrs:{filterable:""},model:{value:a.row.ProvideSubClinicId,callback:function(e){t.$set(a.row,"ProvideSubClinicId",e)},expression:"scope.row.ProvideSubClinicId"}},t._l(t.clinicList,function(t,a){return e("el-option",{key:a,attrs:{label:t.ProvideSubClinicName,value:t.ProvideSubClinicId}})}),1):t._e(),a.row.IsCommonProduct?t._e():e("div",[t._v(t._s(a.row.ProvideSubClinicName))])]}}])}),e("el-table-column",{attrs:{prop:"ProductQuantity",label:"数量",sortable:"","sort-by":"ProductQuantity"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-input-number",{attrs:{min:1,max:999,controls:!1,size:"mini"},on:{change:function(e,i){t.handleNumberChange(e,i,a.$index)}},nativeOn:{click:function(a){return a.stopPropagation(),t.GLOBAL.cancelBubble(a)}},model:{value:a.row.ProductQuantity,callback:function(e){t.$set(a.row,"ProductQuantity",e)},expression:"scope.row.ProductQuantity"}})]}}])})],1),e("h4",[e("el-button",{on:{click:t.cancelSend}},[t._v("取消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.sendToFather}},[t._v("确定")])],1)],1)])},s=[],n=(e("ac6a"),{data:function(){return{mode:1,requestUrl:"",getUrl:"",selectIsFix:!1,optionIsFix:!1,packageBoxClassSelect:"all",searchShortCode:"",packageList:[],multipleSelection:[],getNumber:1,clinicList:[]}},props:["packageClass","getApiLimit"],methods:{handleNumberChange:function(t,a,e){var i=this;void 0==t&&setTimeout(function(){i.packageList[e].ProductQuantity=1},0)},sendToFather:function(){var t=this;if(2===this.mode)this.requestUrl="/api/Package/SupportMaterialProductRegister";else if(1===this.mode||0===this.mode||3===this.mode){var a=[];if(this.multipleSelection.forEach(function(t){a.push(t.ProvideSubClinicId)}),this.GLOBAL.VerificationHandle([{val:a,type:"StringAllNotEmpty",msg:"您选择的通用包没有选择回收科室！请选择回收科室！"}])){for(var e=0;e<this.multipleSelection.length;e++){if(this.multipleSelection[e].IsCommonProduct)for(var i=0;i<this.clinicList.length;i++)this.multipleSelection[e].ProvideSubClinicId===this.clinicList[i].ProvideSubClinicId&&(this.multipleSelection[e].ProvideSubClinicName=this.clinicList[i].ProvideSubClinicName,this.multipleSelection[e].ProvideClinicName=this.clinicList[i].ProvideClinicName);3===this.mode&&(this.multipleSelection[e].IsLostPackage=!0)}this.$emit("packageList-to-father",this.multipleSelection)}return}axios({url:this.requestUrl,data:this.multipleSelection,method:"POST"}).then(function(a){200==a.data.Code?t.$emit("packageList-to-father",a.data.Data):t.showInformation({classify:"message",msg:a.data.Msg})}).catch(function(t){})},cancelSend:function(){this.$emit("packageList-to-father",!1)},handleRowClick:function(t){this.$refs.multipleTable.toggleRowSelection(t)},packageSearch:function(){var t,a=this;0===this.mode?t="/odata/AllProducts?$filter=(type eq '高水平消毒包' or type eq '追溯的无菌包') and (contains(ProductShortCode,".concat("'"+this.searchShortCode+"'",") or contains(ProvideSubClinicShortCode,").concat("'"+this.searchShortCode+"'","))"):1===this.mode?t="/odata/AllProducts?$filter=".concat(this.$props.getApiLimit," and( type eq '高水平消毒包' or type eq '追溯的无菌包') and (contains(ProductShortCode,").concat("'"+this.searchShortCode+"'",") or contains(ProvideSubClinicShortCode,").concat("'"+this.searchShortCode+"'","))"):2===this.mode?t="/odata/AllProducts?$filter=ProvideGenerateType eq '配包生成' and type eq ".concat(encodeURI("'"+this.packageBoxClassSelect+"'")," and (contains(ProductShortCode,").concat("'"+this.searchShortCode+"'",") or contains(ProvideSubClinicShortCode,").concat("'"+this.searchShortCode+"'","))"):3===this.mode&&(t="/odata/AllProducts?$filter=IsNotPrintBarCode eq false and( type eq '高水平消毒包' or type eq '追溯的无菌包') and (contains(ProductShortCode,".concat("'"+this.searchShortCode+"'",") or contains(ProvideSubClinicShortCode,").concat("'"+this.searchShortCode+"'","))")),axios({url:t}).then(function(t){a.packageList=t.data.value}).catch(function(t){})},handleSelectionChange:function(t){this.multipleSelection=t},getRowKeys:function(t){return t.ProductId},packageClassChange:function(){1===this.mode?this.getUrl="all"==this.packageBoxClassSelect?"/odata/AllProducts?$filter=".concat(this.$props.getApiLimit," and( type eq '高水平消毒包' or type eq '追溯的无菌包')"):"/odata/AllProducts?$filter=".concat(this.$props.getApiLimit," and(type eq ").concat(encodeURI("'"+this.packageBoxClassSelect+"')")):3===this.mode?this.getUrl="all"==this.packageBoxClassSelect?"/odata/AllProducts?$filter=IsNotPrintBarCode eq false and( type eq '高水平消毒包' or type eq '追溯的无菌包')":"/odata/AllProducts?$filter=IsNotPrintBarCode eq false and(type eq ".concat(encodeURI("'"+this.packageBoxClassSelect+"')")):2===this.mode?this.getUrl="/odata/AllProducts?$filter=ProvideGenerateType eq '配包生成' and type eq ".concat(encodeURI("'"+this.packageBoxClassSelect+"'")):0===this.mode&&(this.getUrl="all"==this.packageBoxClassSelect?"/odata/AllProducts?$filter=type eq '高水平消毒包' or type eq '追溯的无菌包'":"/odata/AllProducts?$filter=type eq ".concat(encodeURI("'"+this.packageBoxClassSelect+"'"))),this.getPackagesData(this.getUrl)},getPackagesData:function(t){var a=this;axios(t).then(function(t){for(var e=0;e<t.data.value.length;e++)t.data.value[e].IsCommonProduct&&(t.data.value[e].ProvideSubClinicId="");a.packageList=t.data.value,1==a.getNumber&&"追溯的辅料包"!=a.$props.packageClass&&(a.getNumber++,axios({url:"/api/Clinic/SubClinic"}).then(function(t){200==t.data.Code?a.clinicList=t.data.Data:a.showInformation({classify:"message",msg:t.data.Msg})}).catch(function(t){}))}).catch(function(t){})}},created:function(){"追溯的辅料包"==this.$props.packageClass?(this.mode=2,this.packageBoxClassSelect=this.$props.packageClass,this.selectIsFix=!0):"NotBarCodeProducts"==this.$props.packageClass?(this.mode=1,this.optionIsFix=!0):"NewPurchasing"==this.$props.packageClass?(this.mode=0,this.optionIsFix=!0):"LostBarCode"==this.$props.packageClass&&(this.mode=3,this.optionIsFix=!0),this.packageClassChange()}}),o=n,c=(e("f00f"),e("2877")),r=Object(c["a"])(o,i,s,!1,null,null,null);a["a"]=r.exports},"1a10":function(t,a,e){"use strict";var i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{attrs:{id:"photoView"}},[e("div",{staticClass:"container"},[e("div",{staticClass:"view_menu"},[t.$props.viewMode?t._e():e("h3",[e("p",{on:{click:t.switchToTakePhoto}})]),e("el-tabs",{attrs:{type:"card","tab-position":"left"},on:{"tab-click":t.tabClicked},model:{value:t.activeName,callback:function(a){t.activeName=a},expression:"activeName"}},t._l(t.list,function(a,i){return e("el-tab-pane",{key:i,attrs:{name:i+""}},[e("div",{staticClass:"imageListBox",attrs:{slot:"label"},slot:"label"},[e("img",{attrs:{src:a.Path||a.Base64String,alt:""}}),t.$props.viewMode?t._e():e("i",{staticClass:"deleteImg",on:{click:function(a){return a.stopPropagation(),t.deleteImg(i)}}})]),e("transition",{attrs:{name:"fade","enter-active-class":"animated fadeIn faster","leave-active-class":"animated fadeOut faster"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:0==t.mode,expression:"mode==0"}],staticClass:"tab_content"},[e("img",{attrs:{src:a.Path||a.Base64String,alt:""}}),t.$props.viewMode?t._e():e("el-input",{attrs:{type:"textarea",placeholder:"备注",resize:"none"},model:{value:a.Remark,callback:function(e){t.$set(a,"Remark","string"===typeof e?e.trim():e)},expression:"item.Remark"}}),t.$props.viewMode?e("p",[t._v(t._s(a.Remark))]):t._e()],1)])],1)}),1)],1),e("transition",{attrs:{name:"fade","enter-active-class":"animated fadeIn faster","leave-active-class":"animated fadeOut faster"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:1===t.mode,expression:"mode===1"}],staticClass:"view_content"},[e("img",{attrs:{src:t.image,alt:""}}),e("h5",[e("el-button",{staticClass:"btn120x40",on:{click:t.takePhoto}},[t._v("拍照")])],1)])]),e("i",{staticClass:"closePhotoView",on:{click:t.close}})],1)])},s=[],n={props:["data","viewMode","DeletedPicturesId"],data:function(){return{activeName:"-1",mode:0,image:"",list:[]}},created:function(){this.list=null==this.$props.data?[]:this.$props.data,this.list.length>0&&(this.activeName=0),this.$props.viewMode||this.switchToTakePhoto()},beforeDestroy:function(){CSManager.CloseVideo()},methods:{close:function(){this.$emit("viewPhoto-to-father",this.list)},switchToTakePhoto:function(){this.$props.viewMode||CSManager.OpenVideo(50,"",this),this.mode=1},takePhoto:function(){this.list.push({Id:0,Path:"",Base64String:this.image,Remark:""}),this.mode=0,this.activeName=this.list.length-1+""},deleteImg:function(t){var a=this;this.$confirm("您确定要删除该照片?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){0!=a.list[t].Id&&a.$props.DeletedPicturesId.push(a.list[t].Id),a.list.splice(t,1)}).catch(function(){})},tabClicked:function(){this.mode=0}}},o=n,c=(e("68c0"),e("2877")),r=Object(c["a"])(o,i,s,!1,null,null,null);a["a"]=r.exports},"26d8":function(t,a,e){},"386d":function(t,a,e){"use strict";var i=e("cb7c"),s=e("83a1"),n=e("5f1b");e("214f")("search",1,function(t,a,e,o){return[function(e){var i=t(this),s=void 0==e?void 0:e[a];return void 0!==s?s.call(e,i):new RegExp(e)[a](String(i))},function(t){var a=o(e,t,this);if(a.done)return a.value;var c=i(t),r=String(this),l=c.lastIndex;s(l,0)||(c.lastIndex=0);var d=n(c,r);return s(c.lastIndex,l)||(c.lastIndex=l),null===d?-1:d.index}]})},4154:function(t,a,e){"use strict";var i=e("f2af"),s=e.n(i);s.a},"68c0":function(t,a,e){"use strict";var i=e("c38f"),s=e.n(i);s.a},"83a1":function(t,a){t.exports=Object.is||function(t,a){return t===a?0!==t||1/t===1/a:t!=t&&a!=a}},9460:function(t,a,e){},"984c":function(t,a,e){},ac6a:function(t,a,e){for(var i=e("cadf"),s=e("0d58"),n=e("2aba"),o=e("7726"),c=e("32e9"),r=e("84f2"),l=e("2b4c"),d=l("iterator"),u=l("toStringTag"),h=r.Array,p={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},m=s(p),g=0;g<m.length;g++){var f,k=m[g],v=p[k],P=o[k],b=P&&P.prototype;if(b&&(b[d]||c(b,d,h),b[u]||c(b,u,k),r[k]=h,v))for(f in i)b[f]||n(b,f,i[f],!0)}},c38f:function(t,a,e){},c55e:function(t,a,e){"use strict";e.r(a);var i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"cssd_box tabs_half_bar",attrs:{id:"packageTaskList"}},[e("div",{staticClass:"cssd_title"},[e("ul",{staticClass:"cssd_menu"},[e("router-link",{attrs:{to:"/",tag:"li"}},[e("p",[t._v("返回")])]),e("li",{on:{click:t.handleManualEnter}},[e("p",[t._v("手工录入")])]),e("router-link",{attrs:{to:"/package/cleanCheck",tag:"li"}},[e("p",[t._v("清洗审核")])]),e("li",{on:{click:t.addSupportMaterialProduct}},[e("p",[t._v("添加辅料包")])]),t._m(0),e("router-link",{attrs:{to:"/package/taskRecord",tag:"li"}},[e("p",[t._v("配包记录")])])],1),e("div",{staticClass:"cssd_title_right"},[e("p",[e("span",{directives:[{name:"show",rawName:"v-show",value:t.hasNewTask,expression:"hasNewTask"}]},[t._v("有新任务")]),e("i",{on:{click:t.refresh}})])])]),e("div",{staticClass:"cssd_table_center table_collapse table_unExpand"},[e("div",{staticClass:"cssd_table_left"},[e("div",{staticClass:"cssd_talbe_left_menu"},[e("div",{staticClass:"task_origin"},[e("el-select",{attrs:{"popper-class":"taskOrigin"},on:{change:t.originChange},model:{value:t.selectOrigin,callback:function(a){t.selectOrigin=a},expression:"selectOrigin"}},[e("el-option",{attrs:{label:"清洗完成可配包",value:"TasksOfCanBePackage"}}),e("el-option",{attrs:{label:"清洗未完成",value:"PackageTasksFromCleanUndone"}}),e("el-option",{attrs:{label:"灭菌失败",value:"PackageTasksFromSterilizeFailed"}}),e("el-option",{attrs:{label:"辅料包新任务",value:"PackageTasksFromSupportMaterialProduct"}})],1)],1),e("el-tabs",{attrs:{"tab-position":"left"},on:{"tab-click":t.tabsChange},model:{value:t.tabActiveName,callback:function(a){t.tabActiveName=a},expression:"tabActiveName"}},t._l(t.tableData[t.selectOrigin],function(a,i){return e("el-tab-pane",{key:i,attrs:{name:i+""}},[e("div",{staticClass:"tabTh",attrs:{slot:"label"},slot:"label"},[e("h4",[t._v(t._s(a.ClinicName))]),e("h3",[t._v(t._s(a.SubClinicName))])]),e("div",{staticClass:"tab_content table_expand"},[e("div",{staticClass:"content_title"},[e("p",{staticStyle:{width:"210px"}},[t._v("包名称")]),e("p",[t._v("回收时间")]),e("p",{staticStyle:{width:"140px"}},[t._v("外包装")]),e("p",{staticStyle:{width:"60px"}},[t._v("计划数")]),e("p",{staticStyle:{width:"110px"}},[t._v("剩余数")]),e("p",{staticStyle:{width:"60px"}},[t._v("可配数")]),e("p",{staticStyle:{width:"100px"}},[t._v("本次配包数")]),e("p",[t._v("单包网篮")])]),e("el-collapse",{attrs:{accordion:""},on:{change:function(a){t.collapseChange(a,i)}},model:{value:t.activeName,callback:function(a){t.activeName=a},expression:"activeName"}},t._l(a.PackageTasks,function(a,s){return e("el-collapse-item",{key:s,class:a.IsNotBarCodeProduct?"collapseUnExpand":"",attrs:{name:s+""}},[e("div",{staticClass:"collapseTh",attrs:{slot:"title"},slot:"title"},[e("div",{staticClass:"collapseTd",staticStyle:{width:"250px"}},[e("el-popover",{directives:[{name:"show",rawName:"v-show",value:a.IsOuterProduct,expression:"value.IsOuterProduct"}],attrs:{placement:"right-start",width:"200",trigger:"hover"},on:{show:function(e){return t.showPatientMessage(a)}}},[e("div",[e("p",[e("span",[t._v("住院号：")]),e("span",[t._v(t._s(t.patienMessage.PatientHospitalId))])]),e("p",[e("span",[t._v("床号：")]),e("span",[t._v(t._s(t.patienMessage.PatientBedId))])]),e("p",[e("span",[t._v("病人姓名：")]),e("span",[t._v(t._s(t.patienMessage.PatientName))])])]),e("div",{attrs:{slot:"reference"},slot:"reference"},[t._v(t._s(a.ProductName))])]),a.IsOuterProduct?t._e():e("div",[t._v("\n                        "+t._s(a.ProductName)+"\n                        "),e("i",{staticClass:"viewPictures",on:{click:function(e){return e.stopPropagation(),t.viewProductImg(a.ProductId)}}})])],1),e("div",{staticClass:"collapseTd"},[t._v(t._s(a.RecycleDate))]),e("div",{staticClass:"collapseTd",staticStyle:{width:"180px"}},[e("el-select",{staticClass:"green18x10",model:{value:a.ExternalPackageId,callback:function(e){t.$set(a,"ExternalPackageId",e)},expression:"value.ExternalPackageId"}},t._l(t.tableData.ExternalPackages,function(t,a){return e("el-option",{key:a,attrs:{label:t.ExternalPackageName,value:t.ExternalPackageId}})}),1)],1),e("div",{staticClass:"collapseTd",staticStyle:{width:"100px"}},[e("div",[t._v(t._s(a.ScheduleQuantity))])]),e("div",{staticClass:"collapseTd",staticStyle:{width:"150px"}},[t._v("\n                      "+t._s(a.RemainingQuantity)+"\n                      "),e("span",{directives:[{name:"show",rawName:"v-show",value:0!=a.ExpeditedPackageQuantity,expression:"value.ExpeditedPackageQuantity!=0"}],staticClass:"expeditedTag"},[t._v("加急 : "+t._s(a.ExpeditedPackageQuantity))])]),e("div",{staticClass:"collapseTd",staticStyle:{width:"100px"}},[e("div",[t._v(t._s(a.CanBePackagedQuantity))])]),e("div",{staticClass:"collapseTd",staticStyle:{width:"150px"}},[a.IsSingleCarrierProduct?[t._v("1")]:[a.IsNumberProduct?t._e():e("el-input-number",{attrs:{min:0,max:a.CanBePackagedQuantity,controls:!1,size:"mini"},on:{change:function(a,e){t.handleNumberChange(a,e,i,s,"ThisTimePackageQuantity")}},nativeOn:{click:function(a){return a.stopPropagation(),t.GLOBAL.cancelBubble(a)}},model:{value:a.ThisTimePackageQuantity,callback:function(e){t.$set(a,"ThisTimePackageQuantity",e)},expression:"value.ThisTimePackageQuantity"}}),a.IsNumberProduct?e("div",{staticClass:"thisTimePackageNumber"},[e("el-input-number",{attrs:{min:0,size:"mini",max:0==a.NumberProductQuantity?a.CanBePackagedQuantity:a.CanBePackagedQuantity%a.NumberProductQuantity==0?a.CanBePackagedQuantity/a.NumberProductQuantity:(a.CanBePackagedQuantity/a.NumberProductQuantity+"").split(".")[0]-0+1,controls:!1},on:{change:function(a,e){t.handleNumberChange(a,e,i,s,"ThisTimePackageQuantity")}},nativeOn:{click:function(a){return a.stopPropagation(),t.GLOBAL.cancelBubble(a)}},model:{value:a.ThisTimePackageQuantity,callback:function(e){t.$set(a,"ThisTimePackageQuantity",e)},expression:"value.ThisTimePackageQuantity"}}),e("span",{staticClass:"numberPackageSpan"},[t._v("* "+t._s(0==a.NumberProductQuantity?1:a.NumberProductQuantity))]),a.IsNumberProduct&&0!=a.NumberProductQuantity?e("div",{staticClass:"actuallyPackageNumber"},[t._v(t._s(a.ThisTimePackageQuantity*a.NumberProductQuantity>a.CanBePackagedQuantity?"本次配包数为："+a.CanBePackagedQuantity:"本次配包数为："+a.ThisTimePackageQuantity*a.NumberProductQuantity))]):t._e()],1):t._e(),a.IsNumberProduct&&0==a.NumberProductQuantity?e("div",{staticClass:"actuallyPackageNumber"},[t._v(t._s("本次配包数为："+a.ThisTimePackageQuantity))]):t._e()]],2),e("div",{staticClass:"collapseTd"},[e("div",[t._v(t._s(a.SingleCarrierName))])])]),!a.IsNotBarCodeProduct&&a.PackageInstrumentList?e("div",{staticClass:"InstrumentsAndMaterial"},[""!=a.PackageInstrumentList.InstrumentCounts?e("el-table",{attrs:{data:a.PackageInstrumentList.InstrumentCounts}},[e("el-table-column",{attrs:{label:"器械名称",prop:"Name",width:"240"}}),e("el-table-column",{attrs:{label:"器械数/包",prop:"Quantity",width:"210"}}),e("el-table-column")],1):t._e(),""!=a.PackageInstrumentList.MaterialCounts?e("el-table",{attrs:{data:a.PackageInstrumentList.MaterialCounts}},[e("el-table-column",{attrs:{label:"原料名称",prop:"Name",width:"240"}}),e("el-table-column",{attrs:{label:"原料数/包",prop:"Quantity",width:"210"}}),e("el-table-column")],1):t._e()],1):t._e()])}),1),e("div",{staticClass:"tab_content_bottom"},[e("p"),e("p",[e("el-button",{staticClass:"btn150x40main",attrs:{type:"primary",disabled:"PackageTasksFromCleanUndone"==t.selectOrigin},on:{click:t.packageComplete}},[t._v("配包完成")])],1)])],1)])}),1)],1)]),e("div",{staticClass:"cssd_table_right"})]),e("transition",{attrs:{name:"fade","enter-active-class":"animated fadeIn faster","leave-active-class":"animated fadeOut faster"}},[t.isShowTaskListBox?e("TaskListBox",{attrs:{data:t.templateSelection,origin:t.selectOrigin},on:{"to-father":t.taskListBox2father}}):t._e()],1),e("transition",{attrs:{name:"fade","enter-active-class":"animated fadeIn faster","leave-active-class":"animated fadeOut faster"}},[t.isShowPackageList?e("PackageList",{attrs:{packageClass:"追溯的辅料包",getApiLimit:"type eq '追溯的辅料包'"},on:{"packageList-to-father":t.packgeList2father}}):t._e()],1),e("transition",{attrs:{name:"fade","enter-active-class":"animated fadeIn faster","leave-active-class":"animated fadeOut faster"}},[t.isShowPhoto?e("PhotoView",{attrs:{data:t.pictures,viewMode:!0},on:{"viewPhoto-to-father":t.viewPhotoToFather}}):t._e()],1),e("transition",{attrs:{name:"fade","enter-active-class":"animated fadeIn faster","leave-active-class":"animated fadeOut faster"}},[t.isShowManualEnter?e("ManualEnter",{attrs:{BarCodeList:[],ApiUrl:"/api/Scanner/Package/SingleProductCarrier"},on:{"to-father":t.scanner2father}}):t._e()],1)],1)},s=[function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("li",[e("p",[t._v("器械检查")])])}],n=(e("386d"),e("28a5"),e("ac6a"),function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{attrs:{id:"packageTaskListBox"}},[e("ul",[e("li",[e("h4",[t._v("包名称")]),e("p",[t._v(t._s(t.submitData.ProductName))])]),e("li",[e("h4",[t._v("所属科室")]),e("p",[t._v(t._s(t.submitData.SubClinicName))])]),e("li",[e("h4",[t._v("本次配包数量")]),e("p",[t._v(t._s(t.submitData.ThisTimePackageQuantity))])]),e("li",[e("h4",[t._v("已拍照片")]),e("p",[e("span",[t._v(t._s(t.computedPhotoNumber(t.submitData.Pictures)))]),e("a",{on:{click:t.handleShowPhotos}},[t._v("编辑")])])]),e("li",[e("h4",{staticClass:"reviewerText"},[t._v("配包审核人")]),e("p",[e("el-input",{directives:[{name:"focus",rawName:"v-focus"}],attrs:{placeholder:"扫描或手动输入条码"},nativeOn:{keyup:function(a){return!a.type.indexOf("key")&&t._k(a.keyCode,"enter",13,a.key,"Enter")?null:t.submitConfirm(a)}},model:{value:t.submitData.ReviewerBarCode,callback:function(a){t.$set(t.submitData,"ReviewerBarCode",a)},expression:"submitData.ReviewerBarCode"}})],1)]),e("li",{staticStyle:{display:"block"}},[e("el-button",{staticClass:"btn88x32empty",staticStyle:{margin:"0 20px 0 31px"},on:{click:t.cancelSubmit}},[t._v("取消")]),e("el-button",{staticClass:"btn88x32",attrs:{type:"primary",disabled:t.forbid},on:{click:t.submitConfirm}},[t._v("确认")])],1)]),e("transition",{attrs:{name:"fade","enter-active-class":"animated fadeIn faster","leave-active-class":"animated fadeOut faster"}},[t.isShowPhoto?e("PhotoView",{attrs:{data:t.submitData.Pictures},on:{"viewPhoto-to-father":t.viewPhotoToFather}}):t._e()],1)],1)}),o=[],c=e("1a10"),r={data:function(){return{forbid:!1,isShowPhoto:!1,submitData:{Pictures:[],ReviewerBarCode:""}}},props:["data","origin"],components:{PhotoView:c["a"]},created:function(){CSManager.handleDataThis=this},mounted:function(){this.$props.data.Pictures=[],this.$props.data.ReviewerBarCode="",this.submitData=Object.assign({},this.$props.data),this.submitData.ThisTimePackageQuantity=this.submitData.NumberProductQuantity>0?this.submitData.ThisTimePackageQuantity*this.submitData.NumberProductQuantity>this.submitData.CanBePackagedQuantity?this.submitData.CanBePackagedQuantity:this.submitData.ThisTimePackageQuantity*this.submitData.NumberProductQuantity:this.submitData.ThisTimePackageQuantity},methods:{viewPhotoToFather:function(){this.isShowPhoto=!1},handleShowPhotos:function(){this.isShowPhoto=!0},cancelSubmit:function(){this.$emit("to-father","")},submitConfirm:function(){var t=this;this.GLOBAL.VerificationHandle([{val:this.submitData.ReviewerBarCode,type:"StringNotEmpty",msg:"配包审核人不能为空！"}])&&(this.forbid=!0,axios({url:"/api/Package/PackageTaskReceiveAndReturnPrintModel",method:"POST",data:this.submitData}).then(function(a){var e;200==a.data.Code?(e="success",a.data.Data.forEach(function(t){CSManager.PrintBarcode(JSON.stringify(t))}),t.$emit("to-father",{data:{CssdId:t.GLOBAL.UserInfo.ClinicId,ReserveCheckState:!1,PackageState:!0,ProvideState:!1},origin:t.$props.origin})):(t.forbid=!1,e="error"),t.showInformation({classify:"message",msg:a.data.Msg,type:e})}).catch(function(t){}))},handleBarCode:function(t){this.submitData.ReviewerBarCode=t,this.submitConfirm()}},computed:{computedPhotoNumber:function(){return function(t){return t.length}}}},l=r,d=(e("4154"),e("2877")),u=Object(d["a"])(l,n,o,!1,null,"7fd098c8",null),h=u.exports,p=e("03af"),m=e("d040"),g={data:function(){return{isShowManualEnter:!1,hasNewTask:!1,pictures:[],activeName:"-1",tabActiveName:"0",isShowPhoto:!1,isShowPackageList:!1,isShowTaskListBox:!1,selectRadio:0,selectOrigin:"TasksOfCanBePackage",tableData:{PackageTasksFromSterilizeFailed:null,PackageTasksFromCleanUndone:null,PackageTasksFromSupportMaterialProduct:null,TasksOfCanBePackage:null},templateSelection:{},patienMessage:{PatientHospitalId:"",PatientName:"",PatientBedId:""}}},components:{TaskListBox:h,PackageList:p["a"],PhotoView:c["a"],ManualEnter:m["a"]},watch:{"tableData.TasksOfCanBePackage":{handler:function(t){if(null!=t&&""!=t){var a=0;t.forEach(function(t){a+=t.PackageTasks.length}),$(".taskOrigin ul li:first-child").html("<span>清洗完成可配包</span><b>".concat(a,"</b>"))}},immediate:!0,deep:!0},"tableData.PackageTasksFromCleanUndone":{handler:function(t){if(null!=t&&""!=t){var a=0;t.forEach(function(t){a+=t.PackageTasks.length}),$(".taskOrigin ul li:nth-child(2)").html("<span>清洗未完成</span><b>".concat(a,"</b>"))}},immediate:!0,deep:!0},"tableData.PackageTasksFromSterilizeFailed":{handler:function(t){if(null!=t&&""!=t){var a=0;t.forEach(function(t){a+=t.PackageTasks.length}),$(".taskOrigin ul li:nth-child(3)").html("<span>灭菌失败</span><b>".concat(a,"</b>"))}},immediate:!0,deep:!0},"tableData.PackageTasksFromSupportMaterialProduct":{handler:function(t){if(null!=t&&""!=t){var a=0;t.forEach(function(t){a+=t.PackageTasks.length}),$(".taskOrigin ul li:last-child").html("<span>辅料包新任务</span><b>".concat(a,"</b>"))}},immediate:!0,deep:!0}},created:function(){var t=this;CSManager.handleDataThis=this;var a=window.location.search.split("=")[1];a&&(this.selectOrigin=a),axios({url:"/api/Package/PackageTasks"}).then(function(a){200==a.data.Code?t.tableData=a.data.Data:t.showInformation({classify:"message",msg:a.data.Msg})}).catch(function(t){})},mounted:function(){this.GLOBAL.initWebSorcket(this,"PackageState")},beforeDestroy:function(){CSManager.handleDataThis=null},methods:{handleManualEnter:function(){this.isShowManualEnter=!0},scanner2father:function(t){if(this.isShowManualEnter=!1,t&&this.tableData.TasksOfCanBePackage){var a=this.searchSinglePackage(t,"TasksOfCanBePackage");if(a)return;this.searchSinglePackage(t,"PackageTasksFromSterilizeFailed")}},searchSinglePackage:function(t,a){if(this.tableData[a]){this.selectOrigin=a;for(var e=0;e<this.tableData[a].length;e++)for(var i=0;i<this.tableData[a][e].PackageTasks.length;i++)if(t.ProductId===this.tableData[a][e].PackageTasks[i].ProductId&&this.tableData[a][e].PackageTasks[i].CanBePackagedQuantity&&this.tableData[a][e].PackageTasks[i].ExpeditedPackageQuantity)return this.tableData[a][e].PackageTasks[i].SingleCarrierId=t.SingleCarrierId,this.tableData[a][e].PackageTasks[i].SingleCarrierName=t.SingleCarrierName,this.tabActiveName=e+"",this.activeName=i+"",this.selectRadio=this.tableData[a][e].PackageTasks[i].PackageTaskId,this.templateSelection=this.tableData[a][e].PackageTasks[i],!0;for(var s=0;s<this.tableData[a].length;s++)for(var n=0;n<this.tableData[a][s].PackageTasks.length;n++)if(t.ProductId===this.tableData[a][s].PackageTasks[n].ProductId&&this.tableData[a][s].PackageTasks[n].CanBePackagedQuantity)return this.tableData[a][s].PackageTasks[n].SingleCarrierId=t.SingleCarrierId,this.tableData[a][s].PackageTasks[n].SingleCarrierName=t.SingleCarrierName,this.tabActiveName=s+"",this.activeName=n+"",this.selectRadio=this.tableData[a][s].PackageTasks[n].PackageTaskId,this.templateSelection=this.tableData[a][s].PackageTasks[n],!0}},refresh:function(){window.location.reload()},viewProductImg:function(t){var a=this;axios({url:"/api/Product/Picture/".concat(t)}).then(function(t){200==t.data.Code?(a.pictures=t.data.Data,a.isShowPhoto=!0):a.showInformation({classify:"message",msg:t.data.Msg})}).catch(function(t){})},viewPhotoToFather:function(){this.isShowPhoto=!1},originChange:function(){this.selectRadio=0,this.activeName="-1"},showPatientMessage:function(t){var a=this;void 0==t.Requested&&axios({url:"/api/Package/PatientDetailForOuterProduct/".concat(t.PackageTaskId)}).then(function(e){200==e.data.Code?(t.Requested=!0,e.data.Data&&(a.patienMessage=e.data.Data)):a.showInformation({classify:"message",msg:e.data.Msg})}).catch(function(t){})},handleNumberChange:function(t,a,e,i,s){var n=this;void 0==t&&setTimeout(function(){n.tableData[n.selectOrigin][e].PackageTasks[i][s]=1},0)},addSupportMaterialProduct:function(){this.isShowPackageList=!0},packgeList2father:function(t){this.isShowPackageList=!1,t&&(this.tableData=t,this.selectOrigin="PackageTasksFromSupportMaterialProduct",this.selectRadio=0,this.activeName="-1",this.websocket.send(JSON.stringify({CssdId:this.GLOBAL.UserInfo.ClinicId,ReserveCheckState:!1,PackageState:!0,ProvideState:!1})))},taskListBox2father:function(t){""==t&&(this.isShowTaskListBox=!1),t&&(this.websocket.send(JSON.stringify(t.data)),window.location.href="/package/taskList?origin=".concat(t.origin))},packageComplete:function(){if(this.GLOBAL.VerificationHandle([{val:this.selectRadio,type:"NumberNotZero",msg:"您还没有选择配包任务,请选择配包任务！"},{val:this.templateSelection.ThisTimePackageQuantity,type:"NumberNotZero",msg:"配包数不能为0！"}])){if(this.templateSelection.IsSingleCarrierProduct){if(this.templateSelection.IsSingleCarrierProduct&&!this.templateSelection.SingleCarrierId)return void this.showInformation({classify:"message",msg:"单网篮包必须绑定网篮！"});this.templateSelection.ThisTimePackageQuantity=1}this.isShowTaskListBox=!0}},tabsChange:function(t){this.activeName="-1",this.selectRadio=0,this.templateSelection={}},collapseChange:function(t,a){var e=this;if(""!=t){if(this.selectRadio=this.tableData[this.selectOrigin][a].PackageTasks[t].PackageTaskId,this.templateSelection=this.tableData[this.selectOrigin][a].PackageTasks[t],!this.tableData[this.selectOrigin][a].PackageTasks[t].IsNotBarCodeProduct&&!this.tableData[this.selectOrigin][a].PackageTasks[t].PackageInstrumentList){var i="/api/Package/InstrumentAndMaterialBy/".concat(this.tableData[this.selectOrigin][a].PackageTasks[t].ProductId);this.tableData[this.selectOrigin][a].PackageTasks[t].IsOuterProduct&&(i="/api/Package/InstrumentInOuterProduct/".concat(this.tableData[this.selectOrigin][a].PackageTasks[t].PackageTaskId)),axios(i).then(function(i){200==i.data.Code?e.tableData[e.selectOrigin][a].PackageTasks[t].PackageInstrumentList=i.data.Data:e.showInformation({classify:"message",msg:i.data.Msg})}).catch(function(t){})}}else this.selectRadio=0},handleBarCode:function(t){var a=this;axios({url:"/api/Scanner/Package/SingleProductCarrier/".concat(t)}).then(function(t){200==t.data.Code?a.scanner2father(t.data.Data):a.showInformation({classify:"message",msg:t.data.Msg})}).catch(function(t){})}}},f=g,k=(e("f8dd"),Object(d["a"])(f,i,s,!1,null,null,null));a["default"]=k.exports},d040:function(t,a,e){"use strict";var i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{attrs:{id:"manual_enter"}},[e("dl",[e("dt",[e("el-input",{directives:[{name:"focus",rawName:"v-focus"}],attrs:{placeholder:"请扫描或手动录入条码"},nativeOn:{keyup:function(a){return!a.type.indexOf("key")&&t._k(a.keyCode,"enter",13,a.key,"Enter")?null:t.SaveOption(a)}},model:{value:t.input_str,callback:function(a){t.input_str="string"===typeof a?a.trim():a},expression:"input_str"}})],1),e("dd",[e("el-button",{on:{click:t.cancelOption}},[t._v("取消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.SaveOption}},[t._v("确定")])],1)])])},s=[],n=(e("ac6a"),{props:["BarCodeList","ApiUrl","task_index","firstRequest"],data:function(){return{input_str:""}},created:function(){},mounted:function(){},methods:{cancelOption:function(){this.$emit("to-father","")},SaveOption:function(){var t=this;this.GLOBAL.VerificationHandle([{val:this.input_str,type:"StringNotEmpty",msg:"扫描条码不能为空！"}])&&(this.$props.firstRequest?axios("".concat(this.$props.ApiUrl,"/").concat(this.input_str)).then(function(a){if(200==a.data.Code)if(t.$props.task_index>=0)t.$emit("to-father",{data:a.data.Data,index:t.$props.task_index});else{if(a.data.Data.PackageBarCodeScannerVm)for(var e=0;e<t.$props.BarCodeList.length;e++)if(t.$props.BarCodeList[e].BarCode==a.data.Data.PackageBarCodeScannerVm.BarCode)return t.showInformation({classify:"message",msg:"该条码已录入！",type:"warning"}),void(t.input_str="");t.$emit("to-father",a.data.Data,t.input_str)}else 300==a.data.Code?(t.input_str="",t.showInformation({classify:"message",msg:a.data.Msg,type:"warning"})):(t.input_str="",t.showInformation({classify:"message",msg:a.data.Msg,type:"error"}))}).catch(function(t){}):(this.$props.BarCodeList.forEach(function(a){if(a.BarCode==t.input_str.toUpperCase())return t.showInformation({classify:"message",msg:"该条码已录入！",type:"warning"}),void(t.input_str="")}),axios("".concat(this.$props.ApiUrl,"/").concat(this.input_str)).then(function(a){200==a.data.Code?t.$props.task_index>=0?t.$emit("to-father",{data:a.data.Data,index:t.$props.task_index}):t.$emit("to-father",a.data.Data,t.input_str):300==a.data.Code?(t.input_str="",t.showInformation({classify:"message",msg:a.data.Msg,type:"warning"})):(t.input_str="",t.showInformation({classify:"message",msg:a.data.Msg,type:"error"}))}).catch(function(t){})))}}}),o=n,c=(e("dda8"),e("2877")),r=Object(c["a"])(o,i,s,!1,null,null,null);a["a"]=r.exports},dda8:function(t,a,e){"use strict";var i=e("9460"),s=e.n(i);s.a},f00f:function(t,a,e){"use strict";var i=e("984c"),s=e.n(i);s.a},f2af:function(t,a,e){},f8dd:function(t,a,e){"use strict";var i=e("26d8"),s=e.n(i);s.a}}]);