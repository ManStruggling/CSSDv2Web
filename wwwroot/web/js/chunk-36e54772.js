(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-36e54772"],{"1fb4":function(t,i,e){},9460:function(t,i,e){},ac6a:function(t,i,e){for(var a=e("cadf"),s=e("0d58"),n=e("2aba"),o=e("7726"),r=e("32e9"),c=e("84f2"),l=e("2b4c"),d=l("iterator"),u=l("toStringTag"),v=c.Array,p={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},h=s(p),f=0;f<h.length;f++){var m,b=h[f],C=p[b],S=o[b],k=S&&S.prototype;if(k&&(k[d]||r(k,d,v),k[u]||r(k,u,b),c[b]=v,C))for(m in a)k[m]||n(k,m,a[m],!0)}},c7cb:function(t,i,e){"use strict";e.r(i);var a=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"cssd_box tabs_half_bar",attrs:{id:"provideRegistration"}},[e("div",{staticClass:"cssd_title"},[e("ul",{staticClass:"cssd_menu"},[e("router-link",{attrs:{to:"/",tag:"li"}},[e("p",[t._v("返回")])]),e("li",{on:{click:t.handleShowManualEnter}},[e("p",[t._v("手工录入")])]),e("router-link",{attrs:{to:"/provide/borrowRegistration",tag:"li"}},[e("p",[t._v("借用")])]),e("router-link",{attrs:{to:"/provide/record",tag:"li"}},[e("p",[t._v("发放记录")])])],1),e("div",{staticClass:"cssd_title_right"},[e("p",[e("span",{directives:[{name:"show",rawName:"v-show",value:t.hasNewTask,expression:"hasNewTask"}]},[t._v("有新任务")]),e("i",{on:{click:t.refresh}})])])]),e("div",{staticClass:"cssd_table_center"},[e("div",{staticClass:"cssd_table_left"},[e("div",{staticClass:"cssd_talbe_left_menu"},[e("el-tabs",{attrs:{"tab-position":"left"},on:{"tab-click":t.handleTabClick},model:{value:t.tabActiveName,callback:function(i){t.tabActiveName=i},expression:"tabActiveName"}},t._l(t.provideTaskList,function(i,a){return e("el-tab-pane",{key:a,attrs:{name:a+""}},[e("div",{attrs:{slot:"label"},slot:"label"},[e("h3",[t._v(t._s(i.ClinicName))]),e("p",[e("span",[t._v("剩余总发放数:")]),e("b",[t._v(t._s(t.countRemainProvideQuantity(a)))])])]),e("div",{staticClass:"tab_content table_collapse table_unExpand"},[e("div",{staticClass:"selectSubClinic"},[e("p",[t._v("本次发放科室")]),e("el-select",{staticClass:"green24x13",attrs:{"default-first-option":""},on:{change:function(i){return t.provideSubClinicChange(a)}},model:{value:i.SelectedSubClinicId,callback:function(e){t.$set(i,"SelectedSubClinicId",e)},expression:"item.SelectedSubClinicId"}},[e("el-option",{attrs:{label:"全部",value:0}}),t._l(i.SubClinics,function(t,i){return e("el-option",{key:i,attrs:{label:t.SubClinicName,value:t.SubClinicId}})})],2)],1),e("div",{staticClass:"content_title"},[e("p",[t._v("包名称")]),e("p",[t._v("回收时间")]),e("p",[t._v("回收科室")]),e("p",[t._v("发放科室")]),e("p",{staticStyle:{width:"90px"}},[t._v("预计发放数")]),e("p",{staticStyle:{width:"80px"}},[t._v("库存数")]),e("p",{staticStyle:{width:"100px"}},[t._v("剩余发放数")]),e("p",{staticStyle:{width:"100px"}},[t._v("本次发放数")])]),e("el-collapse",{attrs:{accordion:""},model:{value:t.activeName,callback:function(i){t.activeName=i},expression:"activeName"}},t._l(i.SubClinicTasks[i.SelectedSubClinicId].ProvideTaskDetails,function(a,s){return e("el-collapse-item",{key:s,class:a.IsNotPrintBarCode?"collapseUnExpand":"",attrs:{name:s+""}},[e("div",{staticClass:"collapseTh",attrs:{slot:"title"},slot:"title"},[e("div",{staticClass:"collapseTd"},[e("p",[t._v(t._s(a.ProductName))])]),e("div",{staticClass:"collapseTd"},[e("p",[t._v(t._s(a.RecycleDateTime))])]),e("div",{staticClass:"collapseTd"},[e("p",[t._v(t._s(a.RecycleSubClinic))])]),e("div",{staticClass:"collapseTd"},[e("p",[t._v(t._s(a.ProvideSubClinic))])]),e("div",{staticClass:"collapseTd",staticStyle:{width:"130px"}},[e("p",[t._v(t._s(a.ScheduledQuantity))])]),e("div",{staticClass:"collapseTd",staticStyle:{width:"120px"}},[e("p",[t._v(t._s(a.InventoryQuantity))])]),e("div",{staticClass:"collapseTd",staticStyle:{width:"140px"}},[e("p",[t._v("\n                        "+t._s(a.RemainQuantity)+"\n                        "),0!=a.ExpeditedPackageQuantity?e("span",{staticClass:"expeditedTag"},[t._v("加急 : "+t._s(a.ExpeditedPackageQuantity))]):t._e()])]),e("div",{staticClass:"collapseTd",staticStyle:{width:"140px"}},[a.IsNotPrintBarCode?t._e():e("p",[t._v(t._s(t.countThisProvideNumber(a.ProvidePackages,a)))]),a.IsNotPrintBarCode?e("p",[e("el-input-number",{attrs:{min:0,max:a.MaxLimit=a.InventoryQuantity>a.RemainQuantity?a.RemainQuantity:a.InventoryQuantity,controls:!1,size:"mini"},on:{change:function(e,s){t.handleCountNumberPackage(e,s,i.SubClinicTasks[i.SelectedSubClinicId].ProvideTaskDetails,a)}},nativeOn:{click:function(i){return i.stopPropagation(),t.GLOBAL.cancelBubble(i)}},model:{value:a.ThisTimeProvideQuantity,callback:function(i){t.$set(a,"ThisTimeProvideQuantity",i)},expression:"value.ThisTimeProvideQuantity"}})],1):t._e()])]),a.IsNotPrintBarCode?t._e():e("el-table",{attrs:{data:a.ProvidePackages}},[e("el-table-column",{attrs:{label:"包条码",prop:"BarCode",width:"240"}}),e("el-table-column",{attrs:{label:"配包日期",prop:"PackageDate",width:"210"}}),e("el-table-column",{attrs:{label:"有效日期",prop:"ValidDate",width:"210"}}),e("el-table-column",{attrs:{label:"操作",width:"210"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("el-button",{on:{click:function(e){return t.deleteProvidePackage(a.ProvidePackages,i.$index)}}},[t._v("删除")])]}}],null,!0)}),e("el-table-column")],1)],1)}),1),e("div",{staticClass:"tab_content_bottom"},[e("p",[t._v("\n                  共计\n                  "),e("span",[t._v(t._s(t.countPackageNumber(i.SubClinicTasks[i.SelectedSubClinicId])))]),t._v(" 包\n                ")]),e("p",[e("el-button",{staticClass:"btn150x40main",attrs:{type:"primary"},on:{click:function(i){return t.provideSubmit(a)}}},[t._v("发放完成")])],1)])],1)])}),1)],1)]),e("div",{staticClass:"cssd_table_right"})]),e("transition",{attrs:{name:"fade","enter-active-class":"animated fadeIn faster","leave-active-class":"animated fadeOut faster"}},[t.isShowManualEnter?e("ManualEnter",{attrs:{BarCodeList:t.barCodeList,ApiUrl:"/api/Scanner/IncludePackages/Provide"},on:{"to-father":t.packageData2father}}):t._e()],1)],1)},s=[],n=(e("ac6a"),e("d040")),o={data:function(){return{hasNewTask:!1,activeName:"-1",tabActiveName:"0",isShowManualEnter:!1,provideTaskList:[],barCodeList:[]}},components:{ManualEnter:n["a"]},created:function(){var t=this;CSManager.handleDataThis=this,axios({url:"/api/Provide/ProvideTasks"}).then(function(i){if(200==i.data.Code){for(var e=i.data.Data,a=0;a<i.data.Data.length;a++){e[a].SubClinicTasks={},e[a].SelectedSubClinicId=0;for(var s=0;s<e[a].SubClinics.length;s++){e[a].SubClinicTasks[e[a].SubClinics[s].SubClinicId]={ProvideSubClinicId:e[a].SubClinics[s].SubClinicId,ThisClinicProvideNumber:0,ProvideTaskDetails:[]};for(var n=0;n<e[a].TasksOfFixedSubClinic.length;n++)e[a].SubClinics[s].SubClinicId===e[a].TasksOfFixedSubClinic[n].ProvideSubClinicId&&e[a].SubClinicTasks[e[a].SubClinics[s].SubClinicId].ProvideTaskDetails.push(e[a].TasksOfFixedSubClinic[n]);e[a].SubClinicTasks[e[a].SubClinics[s].SubClinicId].ProvideTaskDetails=e[a].SubClinicTasks[e[a].SubClinics[s].SubClinicId].ProvideTaskDetails.concat(e[a].TasksOfCanBeModifySubClinic),e[a].SubClinicTasks[0]={ProvideSubClinicId:0,ThisClinicProvideNumber:0,ProvideTaskDetails:[]},e[a].SubClinicTasks[0].ProvideTaskDetails=e[a].TasksOfFixedSubClinic.concat(e[a].TasksOfCanBeModifySubClinic)}}t.provideTaskList=e}else t.showInformation({classify:"message",msg:i.data.Msg})}).catch(function(t){})},mounted:function(){this.GLOBAL.initWebSorcket(this,"ProvideState")},beforeDestroy:function(){CSManager.handleDataThis=null},methods:{refresh:function(){window.location.reload()},provideSubClinicChange:function(t){this.provideTaskList[t].TasksOfCanBeModifySubClinic.forEach(function(t){t.IsNotPrintBarCode?t.ThisTimeProvideQuantity=0:t.ProvidePackages=[]}),this.provideTaskList[t].TasksOfFixedSubClinic.forEach(function(t){t.IsNotPrintBarCode?t.ThisTimeProvideQuantity=0:t.ProvidePackages=[]}),this.activeName="-1"},handleTabClick:function(t){this.activeName="-1"},handleCountNumberPackage:function(t,i,e,a){if(void 0==t)setTimeout(function(){a.ThisTimeProvideQuantity=0},0);else{var s=0;e.forEach(function(t){a.ProductId==t.ProductId&&(s+=t.ThisTimeProvideQuantity)}),s>a.InventoryQuantity&&(setTimeout(function(){a.ThisTimeProvideQuantity=i},0),this.showInformation({classify:"message",msg:"您所选的数量大于库存数！",type:"warning"}))}},handleShowManualEnter:function(){this.getBarCodeArray(),this.isShowManualEnter=!0},getBarCodeArray:function(){if(this.provideTaskList.length>0){if(0===this.provideTaskList[this.tabActiveName].SelectedSubClinicId)return void this.showInformation({classify:"message",msg:"请选择发放子科室"});for(var t=[],i=this.provideTaskList[this.tabActiveName].SubClinicTasks[this.provideTaskList[this.tabActiveName].SelectedSubClinicId].ProvideTaskDetails,e=0;e<i.length;e++)if(i[e].ProvidePackages)for(var a=0;a<i[e].ProvidePackages.length;a++)t.push(i[e].ProvidePackages[a]);this.barCodeList=t}},provideSubmit:function(t){var i=this;0!==this.provideTaskList[this.tabActiveName].SelectedSubClinicId?this.GLOBAL.VerificationHandle([{val:this.provideTaskList[this.tabActiveName].SubClinicTasks[this.provideTaskList[this.tabActiveName].SelectedSubClinicId].ThisClinicProvideNumber,type:"NumberNotZero",msg:"您还没有发放包，请至少添加一个包！"}])&&axios({url:"/api/Provide/ProvideComplete",method:"POST",data:this.provideTaskList[this.tabActiveName].SubClinicTasks[this.provideTaskList[this.tabActiveName].SelectedSubClinicId]}).then(function(t){var e;200==t.data.Code?(e="success",i.websocket.send(JSON.stringify({CssdId:i.GLOBAL.UserInfo.ClinicId,ReserveCheckState:!1,PackageState:!1,ProvideState:!0})),t.data.Data.forEach(function(t){CSManager.PrintBarcode(JSON.stringify(t))}),i.$router.go(0)):e="error",i.showInformation({classify:"message",msg:t.data.Msg,type:e})}).catch(function(t){}):this.showInformation({classify:"message",msg:"请选择发放子科室"})},deleteProvidePackage:function(t,i){t.splice(i,1)},packageData2father:function(t){var i=this;this.isShowManualEnter=!1,t&&t.forEach(function(t){i.handleAddData(t)})},handleAddData:function(t){if(0!==this.provideTaskList[this.tabActiveName].SelectedSubClinicId){for(var i=this.provideTaskList[this.tabActiveName].SubClinicTasks[this.provideTaskList[this.tabActiveName].SelectedSubClinicId].ProvideTaskDetails,e=0;e<i.length;e++)if(i[e].ProductId==t.ProductId&&i[e].ThisTimeProvideQuantity<i[e].RemainQuantity)return this.activeName=e+"",i[e].ProvidePackages.push(t),void(i[e].ThisTimeProvideQuantity+=1);this.showInformation({classify:"message",msg:"扫入的包与该科室不匹配！或者发放已经到达最大数！"})}else this.showInformation({classify:"message",msg:"请选择发放子科室"})},handleBarCode:function(t){var i=this;this.getBarCodeArray();var e=!0;this.barCodeList.forEach(function(a){if(a.BarCode==t.toUpperCase())return i.showInformation({classify:"message",msg:"该条码已录入！",type:"warning"}),void(e=!1)}),e&&axios({url:"/api/Scanner/IncludePackages/Provide/".concat(t)}).then(function(t){200==t.data.Code?i.packageData2father(t.data.Data):i.showInformation({classify:"message",msg:t.data.Msg})}).catch(function(t){})}},computed:{countPackageNumber:function(){return function(t,i){var e=0;return t.ProvideTaskDetails.forEach(function(t){e+=t.ThisTimeProvideQuantity}),t.ThisClinicProvideNumber=e,e}},countThisProvideNumber:function(){return function(t,i){return i.ThisTimeProvideQuantity=t.length,t.length}},countRemainProvideQuantity:function(){var t=this;return function(i){var e=0;return t.provideTaskList[i].SubClinicTasks[0].ProvideTaskDetails.forEach(function(t){e+=t.RemainQuantity}),e}}}},r=o,c=(e("f549"),e("2877")),l=Object(c["a"])(r,a,s,!1,null,null,null);i["default"]=l.exports},d040:function(t,i,e){"use strict";var a=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{attrs:{id:"manual_enter"}},[e("dl",[e("dt",[e("el-input",{directives:[{name:"focus",rawName:"v-focus"}],attrs:{placeholder:"请扫描或手动录入条码"},nativeOn:{keyup:function(i){return!i.type.indexOf("key")&&t._k(i.keyCode,"enter",13,i.key,"Enter")?null:t.SaveOption(i)}},model:{value:t.input_str,callback:function(i){t.input_str="string"===typeof i?i.trim():i},expression:"input_str"}})],1),e("dd",[e("el-button",{on:{click:t.cancelOption}},[t._v("取消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.SaveOption}},[t._v("确定")])],1)])])},s=[],n=(e("ac6a"),{props:["BarCodeList","ApiUrl","task_index","firstRequest"],data:function(){return{input_str:""}},created:function(){},mounted:function(){},methods:{cancelOption:function(){this.$emit("to-father","")},SaveOption:function(){var t=this;this.GLOBAL.VerificationHandle([{val:this.input_str,type:"StringNotEmpty",msg:"扫描条码不能为空！"}])&&(this.$props.firstRequest?axios("".concat(this.$props.ApiUrl,"/").concat(this.input_str)).then(function(i){if(200==i.data.Code)if(t.$props.task_index>=0)t.$emit("to-father",{data:i.data.Data,index:t.$props.task_index});else{if(i.data.Data.PackageBarCodeScannerVm)for(var e=0;e<t.$props.BarCodeList.length;e++)if(t.$props.BarCodeList[e].BarCode==i.data.Data.PackageBarCodeScannerVm.BarCode)return t.showInformation({classify:"message",msg:"该条码已录入！",type:"warning"}),void(t.input_str="");t.$emit("to-father",i.data.Data,t.input_str)}else 300==i.data.Code?(t.input_str="",t.showInformation({classify:"message",msg:i.data.Msg,type:"warning"})):(t.input_str="",t.showInformation({classify:"message",msg:i.data.Msg,type:"error"}))}).catch(function(t){}):(this.$props.BarCodeList.forEach(function(i){if(i.BarCode==t.input_str.toUpperCase())return t.showInformation({classify:"message",msg:"该条码已录入！",type:"warning"}),void(t.input_str="")}),axios("".concat(this.$props.ApiUrl,"/").concat(this.input_str)).then(function(i){200==i.data.Code?t.$props.task_index>=0?t.$emit("to-father",{data:i.data.Data,index:t.$props.task_index}):t.$emit("to-father",i.data.Data,t.input_str):300==i.data.Code?(t.input_str="",t.showInformation({classify:"message",msg:i.data.Msg,type:"warning"})):(t.input_str="",t.showInformation({classify:"message",msg:i.data.Msg,type:"error"}))}).catch(function(t){})))}}}),o=n,r=(e("dda8"),e("2877")),c=Object(r["a"])(o,a,s,!1,null,null,null);i["a"]=c.exports},dda8:function(t,i,e){"use strict";var a=e("9460"),s=e.n(a);s.a},f549:function(t,i,e){"use strict";var a=e("1fb4"),s=e.n(a);s.a}}]);