(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6e40f7c6"],{"03af":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"basic_package_box"},[a("div",{staticClass:"package_box"},[a("h3",[t.selectIsFix?t._e():a("el-select",{staticClass:"green24x13",on:{change:t.packageClassChange},model:{value:t.packageBoxClassSelect,callback:function(e){t.packageBoxClassSelect=e},expression:"packageBoxClassSelect"}},[a("el-option",{attrs:{label:"全部",value:"all"}}),a("el-option",{attrs:{label:"追溯的无菌包",value:"追溯的无菌包"}}),a("el-option",{attrs:{label:"高水平消毒包",value:"高水平消毒包"}}),a("el-option",{attrs:{label:"追溯的辅料包",value:"追溯的辅料包",disabled:t.optionIsFix}})],1),a("el-input",{style:t.selectIsFix?"width:100%":"",attrs:{placeholder:"请输入拼音简码"},on:{input:t.packageSearch},model:{value:t.searchShortCode,callback:function(e){t.searchShortCode=e},expression:"searchShortCode"}})],1),a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.packageList,"tooltip-effect":"dark","max-height":"300",width:"400","row-key":t.getRowKeys},on:{"row-click":t.handleRowClick,"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55","reserve-selection":!0}}),a("el-table-column",{staticClass:"product_name",attrs:{prop:"ProductName",label:"包名称",width:"201",sortable:"","sort-by":"ProductShortCode","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{prop:"ProvideSubClinicName",label:"所属科室",sortable:"","sort-by":"ProvideSubClinicShortCode",width:"160"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.IsCommonProduct?a("el-select",{staticClass:"green18x10",attrs:{filterable:""},model:{value:e.row.ProvideSubClinicId,callback:function(a){t.$set(e.row,"ProvideSubClinicId",a)},expression:"scope.row.ProvideSubClinicId"}},t._l(t.clinicList,function(t,e){return a("el-option",{key:e,attrs:{label:t.ProvideSubClinicName,value:t.ProvideSubClinicId}})}),1):t._e(),e.row.IsCommonProduct?t._e():a("div",[t._v(t._s(e.row.ProvideSubClinicName))])]}}])}),a("el-table-column",{attrs:{prop:"ProductQuantity",label:"数量",sortable:"","sort-by":"ProductQuantity"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input-number",{attrs:{min:1,max:999,controls:!1,size:"mini"},on:{change:function(a,i){t.handleNumberChange(a,i,e.$index)}},nativeOn:{click:function(e){return e.stopPropagation(),t.GLOBAL.cancelBubble(e)}},model:{value:e.row.ProductQuantity,callback:function(a){t.$set(e.row,"ProductQuantity",a)},expression:"scope.row.ProductQuantity"}})]}}])})],1),a("h4",[a("el-button",{on:{click:t.cancelSend}},[t._v("取消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.sendToFather}},[t._v("确定")])],1)],1)])},c=[],o=(a("ac6a"),{data:function(){return{mode:1,requestUrl:"",getUrl:"",selectIsFix:!1,optionIsFix:!1,packageBoxClassSelect:"all",searchShortCode:"",packageList:[],multipleSelection:[],getNumber:1,clinicList:[]}},props:["packageClass","getApiLimit"],methods:{handleNumberChange:function(t,e,a){var i=this;void 0==t&&setTimeout(function(){i.packageList[a].ProductQuantity=1},0)},sendToFather:function(){var t=this;if(2===this.mode)this.requestUrl="/api/Package/SupportMaterialProductRegister";else if(1===this.mode||0===this.mode||3===this.mode){var e=[];if(this.multipleSelection.forEach(function(t){e.push(t.ProvideSubClinicId)}),this.GLOBAL.VerificationHandle([{val:e,type:"StringAllNotEmpty",msg:"您选择的通用包没有选择回收科室！请选择回收科室！"}])){for(var a=0;a<this.multipleSelection.length;a++){if(this.multipleSelection[a].IsCommonProduct)for(var i=0;i<this.clinicList.length;i++)this.multipleSelection[a].ProvideSubClinicId===this.clinicList[i].ProvideSubClinicId&&(this.multipleSelection[a].ProvideSubClinicName=this.clinicList[i].ProvideSubClinicName,this.multipleSelection[a].ProvideClinicName=this.clinicList[i].ProvideClinicName);3===this.mode&&(this.multipleSelection[a].IsLostPackage=!0)}this.$emit("packageList-to-father",this.multipleSelection)}return}axios({url:this.requestUrl,data:this.multipleSelection,method:"POST"}).then(function(e){200==e.data.Code?t.$emit("packageList-to-father",e.data.Data):t.showInformation({classify:"message",msg:e.data.Msg})}).catch(function(t){})},cancelSend:function(){this.$emit("packageList-to-father",!1)},handleRowClick:function(t){this.$refs.multipleTable.toggleRowSelection(t)},packageSearch:function(){var t,e=this;0===this.mode?t="/odata/AllProducts?$filter=(type eq '高水平消毒包' or type eq '追溯的无菌包') and (contains(ProductShortCode,".concat("'"+this.searchShortCode+"'",") or contains(ProvideSubClinicShortCode,").concat("'"+this.searchShortCode+"'","))"):1===this.mode?t="/odata/AllProducts?$filter=".concat(this.$props.getApiLimit," and( type eq '高水平消毒包' or type eq '追溯的无菌包') and (contains(ProductShortCode,").concat("'"+this.searchShortCode+"'",") or contains(ProvideSubClinicShortCode,").concat("'"+this.searchShortCode+"'","))"):2===this.mode?t="/odata/AllProducts?$filter=ProvideGenerateType eq '配包生成' and type eq ".concat(encodeURI("'"+this.packageBoxClassSelect+"'")," and (contains(ProductShortCode,").concat("'"+this.searchShortCode+"'",") or contains(ProvideSubClinicShortCode,").concat("'"+this.searchShortCode+"'","))"):3===this.mode&&(t="/odata/AllProducts?$filter=IsNotPrintBarCode eq false and( type eq '高水平消毒包' or type eq '追溯的无菌包') and (contains(ProductShortCode,".concat("'"+this.searchShortCode+"'",") or contains(ProvideSubClinicShortCode,").concat("'"+this.searchShortCode+"'","))")),axios({url:t}).then(function(t){e.packageList=t.data.value}).catch(function(t){})},handleSelectionChange:function(t){this.multipleSelection=t},getRowKeys:function(t){return t.ProductId},packageClassChange:function(){1===this.mode?this.getUrl="all"==this.packageBoxClassSelect?"/odata/AllProducts?$filter=".concat(this.$props.getApiLimit," and( type eq '高水平消毒包' or type eq '追溯的无菌包')"):"/odata/AllProducts?$filter=".concat(this.$props.getApiLimit," and(type eq ").concat(encodeURI("'"+this.packageBoxClassSelect+"')")):3===this.mode?this.getUrl="all"==this.packageBoxClassSelect?"/odata/AllProducts?$filter=IsNotPrintBarCode eq false and( type eq '高水平消毒包' or type eq '追溯的无菌包')":"/odata/AllProducts?$filter=IsNotPrintBarCode eq false and(type eq ".concat(encodeURI("'"+this.packageBoxClassSelect+"')")):2===this.mode?this.getUrl="/odata/AllProducts?$filter=ProvideGenerateType eq '配包生成' and type eq ".concat(encodeURI("'"+this.packageBoxClassSelect+"'")):0===this.mode&&(this.getUrl="all"==this.packageBoxClassSelect?"/odata/AllProducts?$filter=type eq '高水平消毒包' or type eq '追溯的无菌包'":"/odata/AllProducts?$filter=type eq ".concat(encodeURI("'"+this.packageBoxClassSelect+"'"))),this.getPackagesData(this.getUrl)},getPackagesData:function(t){var e=this;axios(t).then(function(t){for(var a=0;a<t.data.value.length;a++)t.data.value[a].IsCommonProduct&&(t.data.value[a].ProvideSubClinicId="");e.packageList=t.data.value,1==e.getNumber&&"追溯的辅料包"!=e.$props.packageClass&&(e.getNumber++,axios({url:"/api/Clinic/SubClinic"}).then(function(t){200==t.data.Code?e.clinicList=t.data.Data:e.showInformation({classify:"message",msg:t.data.Msg})}).catch(function(t){}))}).catch(function(t){})}},created:function(){"追溯的辅料包"==this.$props.packageClass?(this.mode=2,this.packageBoxClassSelect=this.$props.packageClass,this.selectIsFix=!0):"NotBarCodeProducts"==this.$props.packageClass?(this.mode=1,this.optionIsFix=!0):"NewPurchasing"==this.$props.packageClass?(this.mode=0,this.optionIsFix=!0):"LostBarCode"==this.$props.packageClass&&(this.mode=3,this.optionIsFix=!0),this.packageClassChange()}}),r=o,n=(a("f00f"),a("2877")),s=Object(n["a"])(r,i,c,!1,null,null,null);e["a"]=s.exports},"09a0":function(t,e,a){},"2b64":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"cssd_box",attrs:{id:"recoveryRegistration"}},[a("div",{staticClass:"cssd_title"},[a("ul",{staticClass:"cssd_menu"},[a("li",{on:{click:t.recoveryGoBack}},[a("p",[t._v("返回")])]),a("li",{on:{click:t.handleShowManualEnter}},[a("p",[t._v("条码手工录入")])]),a("li",{on:{click:t.handelLostBarCode}},[a("p",[t._v("条码丢失登记")])]),a("li",{on:{click:t.handleShowCountPackages}},[a("p",[t._v("计数包回收")])]),t.recoveryRecordModle?t._e():a("router-link",{attrs:{to:{path:"/recovery/record",query:{source:"source eq '回收'"}},tag:"li"}},[a("p",[t._v("回收记录")])])],1),a("div",{staticClass:"cssd_title_right"},[a("p",{staticClass:"commonPackages"},[a("span",[t._v("待分配通用包:")]),a("b",[t._v(t._s(t.waitToAllocation.length))]),a("a",{on:{click:t.displayAllocatedPackages}},[t._v("编辑")])]),a("p",{staticClass:"senderPerson"},[a("span",[t._v("移交人")]),a("el-input",{attrs:{placeholder:"填写移交人"},model:{value:t.recoveryData.SenderName,callback:function(e){t.$set(t.recoveryData,"SenderName","string"===typeof e?e.trim():e)},expression:"recoveryData.SenderName"}})],1),a("span",{directives:[{name:"show",rawName:"v-show",value:0===t.recoveryData.CarrierId,expression:"recoveryData.CarrierId===0"}]},[t._v("暂无网篮")]),a("span",{directives:[{name:"show",rawName:"v-show",value:0!=t.recoveryData.CarrierId,expression:"recoveryData.CarrierId!=0"}],staticClass:"hasCarrierData"},[t._v(t._s(t.recoveryData.CarrierName))])])]),a("div",{staticClass:"cssd_table_center cssd_table_expand tabs_totalBar cssd_totalBar"},[a("el-tabs",{attrs:{type:"border-card","tab-position":"left"},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},t._l(t.recoveryData.Clinics,function(e,i){return a("el-tab-pane",{key:i,attrs:{name:i+""}},[a("div",{attrs:{slot:"label"},slot:"label"},[a("h4",[t._v(t._s(e.ProvideClinicName))]),a("h3",[t._v(t._s(e.ProvideSubClinicName))]),a("div",{staticClass:"tab_count"},[a("p",[a("span",[t._v("总包数:")]),a("b",[t._v(t._s(t.countTotalPackageNumber(e.RecycleProducts,i)))])]),a("p",[a("span",[t._v("包内器械总数:")]),a("b",[t._v(t._s(t.countTotalInstruments(e.RecycleProducts,i)))])])])]),a("div",{staticClass:"tab_content table_collapse"},[a("div",{staticClass:"content_title"},[a("p",[t._v("包名称")]),a("p",{staticStyle:{width:"60px"}},[t._v("包数量")]),a("p",{staticStyle:{width:"100px"}},[t._v("器械总数")]),a("p",{staticStyle:{width:"100px"}},[t._v("剩余还包数")]),a("p",{staticStyle:{width:"100px"}},[t._v("本次还包数")]),a("p",{staticStyle:{width:"60px"}},[t._v("加急包")])]),a("el-collapse",{attrs:{accordion:""},model:{value:t.collapseActiveName,callback:function(e){t.collapseActiveName=e},expression:"collapseActiveName"}},t._l(e.RecycleProducts,function(c,o){return a("el-collapse-item",{key:o,class:c.IsNotPrintBarCode?"collapseUnExpand":"",attrs:{name:o+""}},[a("div",{staticClass:"collapseTh",attrs:{slot:"title"},slot:"title"},[a("div",{staticClass:"collapseTd"},[a("p",[t._v(t._s(c.ProductName))])]),a("div",{staticClass:"collapseTd",staticStyle:{width:"100px"}},[c.IsNotPrintBarCode||c.IsLostPackage?a("p",[a("el-input-number",{attrs:{min:0,max:999,controls:!1,size:"mini"},on:{change:function(a,c){t.handleNumberPackage(a,c,e.RecycleProducts,o,i)}},nativeOn:{click:function(e){return e.stopPropagation(),t.GLOBAL.cancelBubble(e)}},model:{value:c.ProductQuantity,callback:function(e){t.$set(c,"ProductQuantity",e)},expression:"value.ProductQuantity"}})],1):t._e(),0==c.IsNotPrintBarCode&&0==c.IsLostPackage?a("p",[t._v(t._s(t.countPackageNumber(c)))]):t._e()]),a("div",{staticClass:"collapseTd",staticStyle:{width:"140px"}},[0==c.IsNotPrintBarCode&&0==c.IsLostPackage?a("p",[t._v(t._s(t.countPackageInstrumentTotalNumber(c)))]):t._e()]),a("div",{staticClass:"collapseTd",staticStyle:{width:"140px"}},[c.IsNotPrintBarCode?t._e():a("p",[t._v(t._s(c.NumberOfBorrowedProduct))])]),a("div",{staticClass:"collapseTd",staticStyle:{width:"140px"}},[c.IsNotPrintBarCode?t._e():a("p",[a("el-input-number",{attrs:{min:0,max:c.ProductQuantity>c.NumberOfBorrowedProduct?c.NumberOfBorrowedProduct:c.ProductQuantity,controls:!1},nativeOn:{click:function(e){return e.stopPropagation(),t.GLOBAL.cancelBubble(e)}},model:{value:c.NumberOfReturnProduct,callback:function(e){t.$set(c,"NumberOfReturnProduct",e)},expression:"value.NumberOfReturnProduct"}})],1)]),a("div",{staticClass:"collapseTd",staticStyle:{width:"100px"}},[a("p",[a("el-input-number",{attrs:{min:0,max:c.ProductQuantity-c.NumberOfReturnProduct,controls:!1},on:{change:function(a){t.expeditedNumberChange(a,e.RecycleProducts,o)}},nativeOn:{click:function(e){return e.stopPropagation(),t.GLOBAL.cancelBubble(e)}},model:{value:c.NumberOfExpeditedProduct,callback:function(e){t.$set(c,"NumberOfExpeditedProduct",e)},expression:"value.NumberOfExpeditedProduct"}})],1)])]),a("div",{staticClass:"table_expand"},[!1===c.IsNotPrintBarCode&&!1===c.IsLostPackage?a("el-table",{attrs:{data:c.RecyclePackageIds,"default-expand-all":!0}},[a("el-table-column",{attrs:{label:"包条码",prop:"BarCode",width:"240"}}),a("el-table-column",{attrs:{label:"应回收器械数",prop:"ShouldBeRecycledInstrumentTotalQuantity",width:"210"}}),a("el-table-column",{attrs:{label:"实回收器械数",prop:"ActuallyRecycleInstrumentTotalQuantity",width:"210"}}),a("el-table-column",{attrs:{label:"操作",width:"210"},scopedSlots:t._u([{key:"default",fn:function(e){return a("div",{},[a("el-button",{on:{click:function(a){return a.stopPropagation(),t.handleDeletePackage(e.$index,e.row,c.RecyclePackageIds,o,i)}}},[t._v("删除")])],1)}}],null,!0)}),a("el-table-column"),a("el-table-column",{attrs:{type:"expand",width:"1"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"table_detail"},[a("div",{staticClass:"myTableTitle"},[a("p",[t._v("器械名称")]),a("p",[t._v("应回收数")]),a("p",[t._v("实回收数")]),a("div",[t._v("丢失数")])]),a("ul",t._l(e.row.Instruments,function(i,c){return a("li",{key:c},[a("p",[a("span",[t._v(t._s(i.Name))])]),a("p",[a("b",[t._v(t._s(i.ShouldBeRecycledQuantity))])]),a("p",[a("el-input-number",{attrs:{min:0,max:i.ShouldBeRecycledQuantity,controls:!1},on:{change:function(a,i){t.changeInputNum(a,i,e.row,c)}},model:{value:i.ActuallyRecycleQuantity,callback:function(e){t.$set(i,"ActuallyRecycleQuantity",e)},expression:"selfs.ActuallyRecycleQuantity"}})],1),a("div",[t._v(t._s(i.LostInstrumentQuantity))])])}),0)])]}}],null,!0)})],1):t._e()],1)])}),1)],1)])}),1),a("div",{staticClass:"cssd_table_bottom"},[a("p",[t._v("\n        共计\n        "),a("span",[t._v(t._s(t.countPagePackageNumber(t.recoveryData.Clinics)))]),t._v(" 包\n      ")]),a("p",[t.recoveryRecordModle?a("el-button",{on:{click:t.cancelChange}},[t._v("取消修改")]):t._e(),a("el-button",{attrs:{type:"primary"},on:{click:t.recoverySubmit}},[t._v(t._s(t.recoveryRecordModle?"修改完成":"回收完成"))])],1)])],1),a("transition",{attrs:{name:"fade","enter-active-class":"animated fadeIn faster","leave-active-class":"animated fadeOut faster"}},[t.isShowManualEnter?a("ManualEnter",{attrs:{ApiUrl:"/api/Scanner/Recycle",BarCodeList:t.BarCodeList,firstRequest:!0},on:{"to-father":t.packageData2father}}):t._e()],1),a("transition",{attrs:{name:"fade","enter-active-class":"animated fadeIn faster","leave-active-class":"animated fadeOut faster"}},[t.isShowPackageList?a("PackageList",{attrs:{getApiLimit:"IsNotPrintBarCode",packageClass:t.packageClass},on:{"packageList-to-father":t.packgeList2father}}):t._e()],1),a("transition",{attrs:{name:"fade","enter-active-class":"animated fadeIn faster","leave-active-class":"animated fadeOut faster"}},[t.isShowAllocatedPackages?a("AllocatedPackages",{attrs:{list:t.waitToAllocation},on:{"allocated-to-father":t.allocatedToFather}}):t._e()],1)],1)},c=[],o=(a("ac6a"),a("d040")),r=a("03af"),n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"allocatedPackages"}},[a("div",{staticClass:"container table_unExpand"},[a("el-table",{attrs:{data:t.$props.list,height:"500","tooltip-effect":"dark"}},[a("el-table-column",{attrs:{width:"240",label:"包名称",prop:"ProductName","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{width:"170",label:"包条码",prop:"BarCode"}}),a("el-table-column",{attrs:{width:"180",label:"发放科室"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-select",{staticClass:"green18x10",on:{change:function(a){t.provideClinicChange(a,e.row)}},model:{value:e.row.ProvideSubClinicId,callback:function(a){t.$set(e.row,"ProvideSubClinicId",a)},expression:"props.row.ProvideSubClinicId"}},t._l(t.clinicList,function(t,e){return a("el-option",{key:e,attrs:{label:t.ProvideSubClinicName,value:t.ProvideSubClinicId}})}),1)]}}])}),a("el-table-column",{attrs:{width:"100",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("a",{on:{click:function(a){return t.deletePackage(e.$index)}}},[t._v("删除")])]}}])})],1),a("p",{staticClass:"operation"},[a("el-button",{staticClass:"btn88x32empty",on:{click:t.cancelSubmit}},[t._v("取消")]),a("el-button",{staticClass:"btn88x32",attrs:{type:"primary"},on:{click:t.confirmSubmit}},[t._v("确定")])],1)],1)])},s=[],l={data:function(){return{clinicList:[]}},props:["list"],created:function(){var t=this;axios({url:"/api/Clinic/SubClinic"}).then(function(e){200==e.data.Code?t.clinicList=e.data.Data:t.showInformation({classify:"message",msg:e.data.Msg})}).catch(function(t){})},methods:{deletePackage:function(t){var e=this;this.$confirm("确定要删除该包?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$props.list.splice(t,1)}).catch(function(){})},cancelSubmit:function(){this.$emit("allocated-to-father","")},confirmSubmit:function(){this.$props.list.forEach(function(t){t.SelectAgain=!0}),this.$emit("allocated-to-father",!0)},provideClinicChange:function(t,e){for(var a=0;a<this.clinicList.length;a++)if(e.ProvideSubClinicId===this.clinicList[a].ProvideSubClinicId)return e.ProvideSubClinicName=this.clinicList[a].ProvideSubClinicName,void(e.ProvideClinicName=this.clinicList[a].ProvideClinicName)}}},d=l,u=(a("d834"),a("2877")),h=Object(u["a"])(d,n,s,!1,null,null,null),p=h.exports,f={data:function(){return{BarCodeList:[],waitToAllocation:[],packageClass:"",activeName:"0",collapseActiveName:"-1",isShowManualEnter:!1,isShowPackageList:!1,isShowAllocatedPackages:!1,recoveryRecordModle:!1,recoveryData:{CarrierId:0,CarrierName:"",SenderName:"",Clinics:[]},options5:[{value:"HTML",label:"HTML"},{value:"CSS",label:"CSS"},{value:"JavaScript",label:"JavaScript"}]}},components:{ManualEnter:o["a"],PackageList:r["a"],AllocatedPackages:p},created:function(){var t=this;CSManager.handleDataThis=this,this.$route.query.recordId&&(this.recoveryRecordModle=!0,axios({url:"/api/Recycle/PendingUpdateRecycleRecord/".concat(this.$route.query.recordId)}).then(function(e){200==e.data.Code?(t.recoveryData=e.data.Data,t.recoveryData.Clinics=[],t.recoveryData.PackageBarCodeScanners.forEach(function(e){t.handleAddData(e)})):t.showInformation({classify:"message",msg:e.data.Msg})}).catch(function(t){}))},mounted:function(){this.GLOBAL.initWebSorcket(this)},beforeDestroy:function(){CSManager.handleDataThis=null},methods:{recoveryGoBack:function(){this.recoveryRecordModle?this.$router.push({path:"/recovery/record",query:{source:"source eq '回收'"}}):this.$router.push("/")},handleDeletePackage:function(t,e,a,i,c){var o=this;this.$confirm("您确定要删除该包?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.splice(t,1),o.recoveryData.Clinics[c].RecycleProducts[i].NumberOfReturnProduct=0,o.recoveryData.Clinics[c].RecycleProducts[i].NumberOfExpeditedProduct=0,0==a.length&&o.recoveryData.Clinics[c].RecycleProducts.splice(i,1),0==o.recoveryData.Clinics[c].RecycleProducts.length&&o.recoveryData.Clinics.splice(c,1),o.$forceUpdate()}).catch(function(){})},handleShowManualEnter:function(){this.getBarCodeArray(),this.isShowManualEnter=!0},getBarCodeArray:function(){this.BarCodeList=[];for(var t=0;t<this.recoveryData.Clinics.length;t++)for(var e=0;e<this.recoveryData.Clinics[t].RecycleProducts.length;e++)this.recoveryData.Clinics[t].RecycleProducts[e].RecyclePackageIds&&(this.BarCodeList=this.BarCodeList.concat(this.recoveryData.Clinics[t].RecycleProducts[e].RecyclePackageIds));this.BarCodeList=this.BarCodeList.concat(this.waitToAllocation)},handleShowCountPackages:function(){this.packageClass="NotBarCodeProducts",this.isShowPackageList=!0},handelLostBarCode:function(){this.packageClass="LostBarCode",this.isShowPackageList=!0},changeInputNum:function(t,e,a,i){void 0===t?setTimeout(function(){a.Instruments[i].ActuallyRecycleQuantity=e},0):(a.Instruments[i].LostInstrumentQuantity=a.Instruments[i].ShouldBeRecycledQuantity-a.Instruments[i].ActuallyRecycleQuantity,a.ActuallyRecycleInstrumentTotalQuantity=0,a.Instruments.forEach(function(t){a.ActuallyRecycleInstrumentTotalQuantity+=t.ActuallyRecycleQuantity}))},handleNumberPackage:function(t,e,a,i,c){var o=this;a[i].NumberOfExpeditedProduct=0,0!=t&&void 0!=t||this.$confirm("您确定要删除该计数包?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.splice(i,1),0==o.recoveryData.Clinics[c].RecycleProducts.length&&o.recoveryData.Clinics.splice(c,1),o.$forceUpdate()}).catch(function(){a[i].ProductQuantity=e})},expeditedNumberChange:function(t,e,a){void 0==t&&setTimeout(function(){e[a].NumberOfExpeditedProduct=0},0)},cancelChange:function(){this.$router.push({path:"/recovery/record",query:{source:"source eq '回收'"}})},recoverySubmit:function(){var t=this,e="",a="";this.recoveryRecordModle?(e="/api/Recycle/RecycleRecordModify",a="PUT"):(e="/api/Recycle/RecycleComplete",a="POST"),this.recoveryData.RecycleProducts=[];for(var i=0;i<this.recoveryData.Clinics.length;i++)this.recoveryData.RecycleProducts=this.recoveryData.RecycleProducts.concat(this.recoveryData.Clinics[i].RecycleProducts);this.GLOBAL.VerificationHandle([{val:this.recoveryData.CarrierId,type:"NumberNotZero",msg:"网篮不能为空！"},{val:this.recoveryData.RecycleProducts,type:"ArrayNotEmpty",msg:"网篮至少回收一个包！"}])&&axios({url:e,method:a,data:this.recoveryData}).then(function(e){var a;if(200==e.data.Code){a="success";var i={CssdId:t.GLOBAL.UserInfo.ClinicId,ReserveCheckState:!1,PackageState:!0};0===t.GLOBAL.UserInfo.CssdProvideType?i.ProvideState=!0:1===t.GLOBAL.UserInfo.CssdProvideType&&(i.ProvideState=!1),t.websocket.send(JSON.stringify(i)),t.recoveryRecordModle?t.$router.push({path:"/recovery/record",query:{source:"source eq '回收'"}}):t.$router.go({path:"/recovery/registration",query:{message:"test"}})}else a="error";t.showInformation({classify:"message",msg:e.data.Msg,type:a})}).catch(function(t){})},allocatedToFather:function(t){var e=this;this.isShowAllocatedPackages=!1,t&&(this.waitToAllocation.forEach(function(t){e.handleAddData(t)}),this.waitToAllocation=[])},displayAllocatedPackages:function(){this.isShowAllocatedPackages=!0},packageData2father:function(t){var e=this;this.isShowManualEnter=!1,t.PackageBarCodeScannerVm?this.handleAddData(t.PackageBarCodeScannerVm):t.CarrierBarCodeScannerVm&&(0==this.recoveryData.CarrierId?(this.recoveryData.CarrierId=t.CarrierBarCodeScannerVm.Id,this.recoveryData.CarrierName=t.CarrierBarCodeScannerVm.Name):this.$confirm("您已录入网篮,是否需要替换该网篮?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.recoveryData.CarrierId=t.CarrierBarCodeScannerVm.Id,e.recoveryData.CarrierName=t.CarrierBarCodeScannerVm.Name}).catch(function(){}))},packgeList2father:function(t){if(this.isShowPackageList=!1,t)for(var e=0;e<t.length;e++)this.handleAddData(t[e])},handleAddData:function(t){if(t.PackageBarCodeId&&t.IsCommonProduct&&!t.SelectAgain)this.waitToAllocation.push(t);else{for(var e=this.recoveryData.Clinics,a=!0,i=!0,c=0;c<e.length;c++)if(e[c].ProvideSubClinicId==t.ProvideSubClinicId){this.activeName=c+"",a=!1;for(var o=0;o<e[c].RecycleProducts.length;o++)e[c].RecycleProducts[o].ProductId==t.ProductId&&!1===t.IsLostPackage&&0!=t.PackageBarCodeId&&(this.collapseActiveName=o+"",i=!1,this.recoveryData.Clinics[c].RecycleProducts[o].RecyclePackageIds.push(t)),e[c].RecycleProducts[o].ProductId==t.ProductId&&!0===t.IsNotPrintBarCode&&!0===e[c].RecycleProducts[o].IsNotPrintBarCode&&(i=!1,this.recoveryData.Clinics[c].RecycleProducts[o].ProductQuantity+=t.ProductQuantity),e[c].RecycleProducts[o].ProductId==t.ProductId&&!0===t.IsLostPackage&&!0===e[c].RecycleProducts[o].IsLostPackage&&(i=!1,this.recoveryData.Clinics[c].RecycleProducts[o].ProductQuantity+=t.ProductQuantity);if(i){var r=void 0;t.IsNotPrintBarCode||t.IsLostPackage?r=t:(r={ProductName:t.ProductName,IsLostPackage:!1,IsNotPrintBarCode:!1,ProductId:t.ProductId,ProvideSubClinicId:t.ProvideSubClinicId,NumberOfBorrowedProduct:t.NumberOfBorrowedProduct,NumberOfExpeditedProduct:t.NumberOfExpeditedProduct,NumberOfReturnProduct:t.NumberOfReturnProduct,RecyclePackageIds:[t]},t.IsSingleCarrierProduct?r.IsSingleCarrierProduct=!0:r.IsSingleCarrierProduct=!1),this.recoveryData.Clinics[c].RecycleProducts.push(r),this.collapseActiveName=this.recoveryData.Clinics[c].RecycleProducts.length-1+""}}if(a){var n={};t.IsNotPrintBarCode||t.IsLostPackage?n=t:(n={ProductName:t.ProductName,IsLostPackage:!1,IsNotPrintBarCode:!1,ProductId:t.ProductId,ProvideSubClinicId:t.ProvideSubClinicId,NumberOfBorrowedProduct:t.NumberOfBorrowedProduct,NumberOfExpeditedProduct:t.NumberOfExpeditedProduct,NumberOfReturnProduct:t.NumberOfReturnProduct,RecyclePackageIds:[t]},t.IsSingleCarrierProduct?n.IsSingleCarrierProduct=!0:n.IsSingleCarrierProduct=!1),this.recoveryData.Clinics.push({ProvideClinicName:t.ProvideClinicName,ProvideSubClinicName:t.ProvideSubClinicName,ProvideSubClinicId:t.ProvideSubClinicId,RecycleProducts:[n]}),this.activeName=this.recoveryData.Clinics.length-1+"",this.collapseActiveName="0"}}},handleBarCode:function(t){var e=this;this.getBarCodeArray();var a=!0;this.BarCodeList.forEach(function(i){if(i.BarCode==t.toUpperCase())return e.showInformation({classify:"message",msg:"该条码已录入！",type:"warning"}),void(a=!1)}),a&&axios({url:"/api/Scanner/Recycle/".concat(t)}).then(function(a){if(200==a.data.Code){if(a.data.Data.PackageBarCodeScannerVm)for(var i=0;i<e.BarCodeList.length;i++)if(e.BarCodeList[i].BarCode==a.data.Data.PackageBarCodeScannerVm.BarCode)return void e.showInformation({classify:"message",msg:"该条码已录入！",type:"warning"});e.packageData2father(a.data.Data,t)}else e.showInformation({classify:"message",msg:a.data.Msg})}).catch(function(t){})}},computed:{countPackageNumber:function(){return function(t){return t.ProductQuantity=t.RecyclePackageIds.length,t.RecyclePackageIds.length}},countPackageInstrumentTotalNumber:function(){return function(t){var e=0;return t.RecyclePackageIds.forEach(function(t){e+=t.ActuallyRecycleInstrumentTotalQuantity}),e}},countTotalPackageNumber:function(){var t=this;return function(e,a){var i=0;return e.forEach(function(e){e.IsNotPrintBarCode||e.IsLostPackage?void 0!=e.ProductQuantity&&(i+=e.ProductQuantity):i+=e.RecyclePackageIds.length,t.recoveryData.Clinics[a].TotalPackageNumberInClinic=i}),i}},countTotalInstruments:function(){return function(t,e){for(var a=0,i=0;i<t.length;i++)if(t[i].RecyclePackageIds)for(var c=0;c<t[i].RecyclePackageIds.length;c++)a+=t[i].RecyclePackageIds[c].ActuallyRecycleInstrumentTotalQuantity;return a}},countPagePackageNumber:function(){return function(t){var e=0;return t.forEach(function(t){e+=t.TotalPackageNumberInClinic}),e}}}},m=f,v=(a("c0ae"),Object(u["a"])(m,i,c,!1,null,null,null));e["default"]=v.exports},9460:function(t,e,a){},"984c":function(t,e,a){},ac6a:function(t,e,a){for(var i=a("cadf"),c=a("0d58"),o=a("2aba"),r=a("7726"),n=a("32e9"),s=a("84f2"),l=a("2b4c"),d=l("iterator"),u=l("toStringTag"),h=s.Array,p={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},f=c(p),m=0;m<f.length;m++){var v,y=f[m],C=p[y],g=r[y],P=g&&g.prototype;if(P&&(P[d]||n(P,d,h),P[u]||n(P,u,y),s[y]=h,C))for(v in i)P[v]||o(P,v,i[v],!0)}},c0ae:function(t,e,a){"use strict";var i=a("c156"),c=a.n(i);c.a},c156:function(t,e,a){},d040:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"manual_enter"}},[a("dl",[a("dt",[a("el-input",{directives:[{name:"focus",rawName:"v-focus"}],attrs:{placeholder:"请扫描或手动录入条码"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.SaveOption(e)}},model:{value:t.input_str,callback:function(e){t.input_str="string"===typeof e?e.trim():e},expression:"input_str"}})],1),a("dd",[a("el-button",{on:{click:t.cancelOption}},[t._v("取消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.SaveOption}},[t._v("确定")])],1)])])},c=[],o=(a("ac6a"),{props:["BarCodeList","ApiUrl","task_index","firstRequest"],data:function(){return{input_str:""}},created:function(){},mounted:function(){},methods:{cancelOption:function(){this.$emit("to-father","")},SaveOption:function(){var t=this;this.GLOBAL.VerificationHandle([{val:this.input_str,type:"StringNotEmpty",msg:"扫描条码不能为空！"}])&&(this.$props.firstRequest?axios("".concat(this.$props.ApiUrl,"/").concat(this.input_str)).then(function(e){if(200==e.data.Code)if(t.$props.task_index>=0)t.$emit("to-father",{data:e.data.Data,index:t.$props.task_index});else{if(e.data.Data.PackageBarCodeScannerVm)for(var a=0;a<t.$props.BarCodeList.length;a++)if(t.$props.BarCodeList[a].BarCode==e.data.Data.PackageBarCodeScannerVm.BarCode)return t.showInformation({classify:"message",msg:"该条码已录入！",type:"warning"}),void(t.input_str="");t.$emit("to-father",e.data.Data,t.input_str)}else 300==e.data.Code?(t.input_str="",t.showInformation({classify:"message",msg:e.data.Msg,type:"warning"})):(t.input_str="",t.showInformation({classify:"message",msg:e.data.Msg,type:"error"}))}).catch(function(t){}):(this.$props.BarCodeList.forEach(function(e){if(e.BarCode==t.input_str.toUpperCase())return t.showInformation({classify:"message",msg:"该条码已录入！",type:"warning"}),void(t.input_str="")}),axios("".concat(this.$props.ApiUrl,"/").concat(this.input_str)).then(function(e){200==e.data.Code?t.$props.task_index>=0?t.$emit("to-father",{data:e.data.Data,index:t.$props.task_index}):t.$emit("to-father",e.data.Data,t.input_str):300==e.data.Code?(t.input_str="",t.showInformation({classify:"message",msg:e.data.Msg,type:"warning"})):(t.input_str="",t.showInformation({classify:"message",msg:e.data.Msg,type:"error"}))}).catch(function(t){})))}}}),r=o,n=(a("dda8"),a("2877")),s=Object(n["a"])(r,i,c,!1,null,null,null);e["a"]=s.exports},d834:function(t,e,a){"use strict";var i=a("09a0"),c=a.n(i);c.a},dda8:function(t,e,a){"use strict";var i=a("9460"),c=a.n(i);c.a},f00f:function(t,e,a){"use strict";var i=a("984c"),c=a.n(i);c.a}}]);