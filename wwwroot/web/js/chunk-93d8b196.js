(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-93d8b196"],{"0ce2":function(t,e,a){},1:function(t,e){},2:function(t,e){},2681:function(t,e,a){"use strict";var i=a("0ce2"),o=a.n(i);o.a},3:function(t,e){},"58d7":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"barCodeList"}},[a("div",{staticClass:"barCode_box"},[a("div",{staticClass:"container"},[a("el-table",{ref:"multipleTable",attrs:{data:t.dataList,"tooltip-effect":"dark",height:"508","row-key":t.getRowKeys},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"130","reserve-selection":!0}}),t._l(t.$props.labels,function(t,e){return a("el-table-column",{key:e,attrs:{label:t.label,prop:t.prop}})}),a("el-table-column")],2)],1),a("div",{staticClass:"barCode_box_b"},[a("el-button",{staticClass:"btn88x32empty",on:{click:t.cancelSubmit}},[t._v("取消")]),a("el-button",{staticClass:"btn88x32",attrs:{type:"primary"},on:{click:t.saveSubmit}},[t._v("确定")])],1)])])},o=[],n={props:["data","labels","printUrl"],data:function(){return{checkList:[],dataList:[]}},created:function(){CSManager.handleDataThis=this,this.dataList=this.$props.data.slice(0)},mounted:function(){},methods:{getRowKeys:function(t){return t.Id},handleSelectionChange:function(t){this.checkList=t},cancelSubmit:function(){this.$emit("printList-to-father")},saveSubmit:function(){var t=this;this.GLOBAL.VerificationHandle([{val:this.checkList,type:"ArrayNotEmpty",msg:"至少选择一个打印条码！"}])&&axios({url:"".concat(this.$props.printUrl),data:this.checkList,method:"POST"}).then(function(e){200==e.data.Code?(CSManager.PrintBarcode(JSON.stringify(e.data.Data)),t.$emit("printList-to-father")):t.showInformation({classify:"message",msg:e.data.Msg})}).catch(function(t){})}}},s=n,l=(a("2681"),a("2877")),c=Object(l["a"])(s,i,o,!1,null,null,null);e["a"]=c.exports},"590e":function(t,e,a){"use strict";var i=a("642d"),o=a.n(i);o.a},"642d":function(t,e,a){},c3f3:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"basic_main"},[a("div",{staticClass:"basic_main_head"},[a("p",[a("el-input",{staticClass:"basic_ipt_search",attrs:{type:"text",placeholder:"搜索"},on:{input:t.searchThisTableData},model:{value:t.basic_search,callback:function(e){t.basic_search="string"===typeof e?e.trim():e},expression:"basic_search"}})],1),a("p",[t.GLOBAL.UserInfo.JobAndCompetence.includes("000")?a("a",{attrs:{href:"\\ImportBaseData\\人员汇入.xlsx",download:"人员汇入"}},[t._v("下载模板")]):t._e(),t.GLOBAL.UserInfo.JobAndCompetence.includes("000")?a("el-button",{staticClass:"importData"},[a("input",{attrs:{type:"file",id:"fileUploader",name:"fileUploader",accept:".xls, .xlsx"},on:{change:t.fileChange}})]):t._e(),a("el-button",{on:{click:t.handlePrint}},[t._v("打印条码")]),a("el-button",{staticClass:"basic_ipt_add",attrs:{type:"primary"},on:{click:t.addTableTr}},[t._v("新增员工")])],1)]),a("div",{staticClass:"basic_table table_unExpand"},[a("el-table",{attrs:{data:t.table_data}},[a("el-table-column",{attrs:{label:"员工姓名",prop:"Name",width:"240"}}),a("el-table-column",{attrs:{label:"员工工号",prop:"JobNumber",width:"210"}}),a("el-table-column",{attrs:{label:"员工条码编号",prop:"BarCode",width:"210"}}),a("el-table-column",{attrs:{label:"登录密码",prop:"Password",width:"210"}}),a("el-table-column",{attrs:{label:"操作",width:"210"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("a",{staticClass:"change_this_tr",on:{click:function(a){return a.stopPropagation(),t.editThisTr(e.$index)}}},[t._v("编辑")]),a("a",{staticClass:"delete_this_tr",on:{click:function(a){return a.stopPropagation(),t.deleteThisTr(e.$index)}}},[t._v("删除")])]}}])}),a("el-table-column")],1)],1),a("transition",{attrs:{name:"fade","enter-active-class":"animated fadeIn faster","leave-active-class":"animated fadeOut faster"}},[t.isShowBarCodeList?a("PrintBarCodeList",{attrs:{data:t.table_data,labels:[{prop:"BarCode",label:"人员条码"},{prop:"Name",label:"人员名称"}],printUrl:"/api/Print/Staff"},on:{"printList-to-father":t.barCodeListToFather}}):t._e()],1),a("transition",{attrs:{name:"fade","enter-active-class":"animated fadeIn faster","leave-active-class":"animated fadeOut faster"}},[t.showEditBox?a("StaffBox",{attrs:{data:t.toChildData},on:{"to-father":t.child2father}}):t._e()],1)],1)},o=[],n=(a("ac6a"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"staffBox",attrs:{id:"editBox"}},[a("div",{staticClass:"editContainer"},[a("div",{staticClass:"editContent"},[a("ul",{staticClass:"clear_float"},[a("li",[a("p",[t._v("员工姓名")]),a("el-input",{attrs:{type:"text",placeholder:"员工姓名(必填)",maxlength:"10"},model:{value:t.editBoxData.Name,callback:function(e){t.$set(t.editBoxData,"Name","string"===typeof e?e.trim():e)},expression:"editBoxData.Name"}})],1),a("li",[a("p",[t._v("员工工号")]),a("el-input",{attrs:{placeholder:"员工工号(必填)"},model:{value:t.editBoxData.JobNumber,callback:function(e){t.$set(t.editBoxData,"JobNumber","string"===typeof e?e.trim():e)},expression:"editBoxData.JobNumber"}})],1),a("li",[a("p",[t._v("员工条码编号")]),a("el-input",{attrs:{type:"text",disabled:!0},model:{value:t.editBoxData.BarCode,callback:function(e){t.$set(t.editBoxData,"BarCode",e)},expression:"editBoxData.BarCode"}})],1),a("li",[a("p",[t._v("登录密码")]),a("el-input",{attrs:{placeholder:"登录密码(必填)"},model:{value:t.editBoxData.Password,callback:function(e){t.$set(t.editBoxData,"Password","string"===typeof e?e.trim():e)},expression:"editBoxData.Password"}})],1)]),a("el-tabs",{attrs:{closable:"",addable:"",type:"card"},on:{edit:t.handleTabsEdit},model:{value:t.tabActiveName,callback:function(e){t.tabActiveName=e},expression:"tabActiveName"}},t._l(t.editBoxData.RolesForStaff,function(e,i){return a("el-tab-pane",{key:i,attrs:{label:e.ClinicName,name:i+""}},[a("div",{staticClass:"powerDetail"},[a("el-table",{attrs:{data:e.JobAndCompetence}},[a("el-table-column",{attrs:{label:"岗位"},scopedSlots:t._u([{key:"default",fn:function(o){return[a("el-select",{staticClass:"green18x10",attrs:{filterable:"","default-first-option":"",disabled:o.row.Forbid,placeholder:"请选择(必填)"},on:{change:function(e){t.forbidOption(e,i,o.row)}},model:{value:o.row.RoleJob,callback:function(e){t.$set(o.row,"RoleJob",e)},expression:"props.row.RoleJob"}},t._l(e.Roles,function(t,e){return a("el-option",{key:e,attrs:{label:t.Item1,value:t.Item2,disabled:t.Forbid}})}),1)]}}],null,!0)}),a("el-table-column",{attrs:{label:"职位"},scopedSlots:t._u([{key:"default",fn:function(i){return[a("el-select",{staticClass:"green18x10",attrs:{filterable:"","default-first-option":"",placeholder:"请选择(必填)"},model:{value:i.row.Competence,callback:function(e){t.$set(i.row,"Competence",e)},expression:"props.row.Competence"}},t._l(e.RoleCompetence,function(t,e){return a("el-option",{key:e,attrs:{label:t.Item1,value:t.Item2,disabled:t.Forbid}})}),1)]}}],null,!0)}),a("el-table-column",{attrs:{label:"操作",width:"60"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("a",{on:{click:function(a){return t.deleteCompetence(i,e.$index)}}},[t._v("删除")])]}}],null,!0)})],1),a("div",{staticClass:"switchBox"},[a("p",[a("span",[t._v("护士长")]),a("el-switch",{attrs:{"active-color":"#01BF6A","inactive-color":"#dbdde6","active-value":!0,"inactive-value":!1},on:{change:function(a){t.matronSwitchChange(a,e)}},model:{value:e.IsMatron,callback:function(a){t.$set(e,"IsMatron",a)},expression:"item.IsMatron"}})],1),a("p",[a("span",[t._v("预设权限")]),a("el-switch",{attrs:{"active-color":"#01BF6A","inactive-color":"#dbdde6","active-value":!0,"inactive-value":!1},on:{change:function(a){t.defaultSwitchChange(a,e)}},model:{value:e.IsDefaultNurse,callback:function(a){t.$set(e,"IsDefaultNurse",a)},expression:"item.IsDefaultNurse"}})],1)]),a("el-button",{staticClass:"btn88x32",attrs:{size:"mini",type:"primary",disabled:e.AddRoleForbid},on:{click:function(e){return t.addCompetence(i)}}},[t._v("新增权限")])],1)])}),1)],1),a("div",{staticClass:"editBoxOption"},[a("el-button",{on:{click:t.editBoxCancelSave}},[t._v("取消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.editBoxSave}},[t._v("完成")])],1)]),a("transition",{attrs:{name:"fade","enter-active-class":"animated fadeIn faster","leave-active-class":"animated fadeOut faster"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowClinicSelect,expression:"isShowClinicSelect"}],staticClass:"clinic_select_box"},[a("dl",[a("dt",[a("el-select",{staticClass:"green18x10",attrs:{filterable:"","default-first-option":""},model:{value:t.clinicSelect,callback:function(e){t.clinicSelect=e},expression:"clinicSelect"}},t._l(t.powersAndRoles.Clinics,function(t,e){return a("el-option",{key:e,attrs:{label:t.ClinicName,value:t.ClinicId}})}),1)],1),a("dd",[a("el-button",{staticClass:"btn88x32empty",on:{click:t.cancelAdd}},[t._v("取消")]),a("el-button",{staticClass:"btn88x32",attrs:{type:"primary"},on:{click:t.addComplete}},[t._v("确定")])],1)])])])],1)}),s=[],l={props:["data"],data:function(){return{powersAndRoles:{},clinicSelect:"",isShowClinicSelect:!1,tabActiveName:"0",editBoxData:{Id:0,Name:"",JobNumber:"",BarCode:"",Password:"",RolesForStaff:[]}}},created:function(){var t=this;this.editBoxData=this.$props.data,axios({url:"/api/Staff/ClinicsAndOwnerRoles"}).then(function(e){if(200==e.data.Code){if(t.powersAndRoles=e.data.Data,t.editBoxData.RoleJsonData&&(t.editBoxData.RolesForStaff=JSON.parse(t.editBoxData.RoleJsonData).RolesForStaff,JSON.parse(t.editBoxData.RoleJsonData).IsImport)){t.editBoxData.RolesForStaff;for(var a=0;a<t.editBoxData.RolesForStaff.length;a++){t.editBoxData.RolesForStaff[a].RoleCompetence=t.powersAndRoles.RoleCompetence;for(var i=0;a<t.powersAndRoles.Clinics.length;i++)if(t.editBoxData.RolesForStaff[a].ClinicId===t.powersAndRoles.Clinics[i].ClinicId){1===t.powersAndRoles.Clinics[i].ClinicType?t.editBoxData.RolesForStaff[a].Roles=t.powersAndRoles.RoleJobCssd:t.editBoxData.RolesForStaff[a].Roles=t.powersAndRoles.RoleJobClinic,t.editBoxData.RolesForStaff[a].ClinicName=t.powersAndRoles.Clinics[i].ClinicName,t.editBoxData.RolesForStaff[a].JobAndCompetence=[],t.editBoxData.RolesForStaff[a].AddRoleForbid=!0;break}}}}else t.showInformation({classify:"message",msg:e.data.Msg})}).catch(function(t){})},methods:{defaultSwitchChange:function(t,e){t?(e.IsMatron=!1,e.AddRoleForbid=!0,e.JobAndCompetence=[],e.Roles.forEach(function(t){t.Forbid=!1})):e.AddRoleForbid=!1,this.$forceUpdate()},matronSwitchChange:function(t,e){t?(e.AddRoleForbid=!0,e.IsDefaultNurse=!1,e.JobAndCompetence=[],e.Roles.forEach(function(t){t.Forbid=!1})):e.AddRoleForbid=!1,this.$forceUpdate()},forbidOption:function(t,e,a){a.Forbid=!0,this.editBoxData.RolesForStaff[e].Roles.forEach(function(e){e.Item2!=t||(e.Forbid=!0)})},addCompetence:function(t){this.editBoxData.RolesForStaff[t].JobAndCompetence.push({RoleJob:"",Competence:""})},deleteCompetence:function(t,e){var a=this;this.editBoxData.RolesForStaff[t].Roles.forEach(function(i){i.Item2==a.editBoxData.RolesForStaff[t].JobAndCompetence[e].RoleJob&&(i.Forbid=!1)}),this.editBoxData.RolesForStaff[t].JobAndCompetence.splice(e,1)},cancelAdd:function(){this.isShowClinicSelect=!1,this.clinicSelect=""},addComplete:function(){var t=this;this.GLOBAL.VerificationHandle([{val:this.clinicSelect,type:"StringNotEmpty",msg:"您还没有选择科室！请选择科室！"}])&&(this.clinicSelect=this.powersAndRoles.Clinics.filter(function(e){return e.ClinicId==t.clinicSelect})[0],0==this.editBoxData.RolesForStaff.filter(function(e){return e.ClinicId==t.clinicSelect.ClinicId}).length?(this.editBoxData.RolesForStaff.push({ClinicId:this.clinicSelect.ClinicId,ClinicName:this.clinicSelect.ClinicName,ClinicType:this.clinicSelect.ClinicType,IsMatron:!1,IsDefaultNurse:!1,JobAndCompetence:[],Roles:1==this.clinicSelect.ClinicType?this.powersAndRoles.RoleJobCssd:this.powersAndRoles.RoleJobClinic,RoleCompetence:this.powersAndRoles.RoleCompetence}),this.clinicSelect="",this.isShowClinicSelect=!1):(this.clinicSelect="",this.showInformation({classify:"message",msg:"该科室已经添加了!请重新选择科室!",type:"warning"})))},handleTabsEdit:function(t,e){var a=this;"add"===e&&(this.isShowClinicSelect=!0),"remove"===e&&this.$confirm("您确定要删除该科室的权限?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.editBoxData.RolesForStaff.splice(t,1),a.$forceUpdate()}).catch(function(){})},editBoxCancelSave:function(){this.$emit("to-father","")},editBoxSave:function(){var t=this,e="";if(e=0==this.editBoxData.Id?"post":"put",this.GLOBAL.VerificationHandle([{val:this.editBoxData.Name,type:"StringNotEmpty",msg:"员工名字不能为空！"},{val:this.editBoxData.JobNumber,type:"AccountOrPassword",msg:"账号不符合规范！账号必须为字母、数字、下划线。"},{val:this.editBoxData.Password,type:"AccountOrPassword",msg:"密码不符合规范！账号必须为字母、数字、下划线。"},{val:this.editBoxData.RolesForStaff,type:"ArrayNotEmpty",msg:"您还没有为员工配权限！"}])){var a=[],i=[];if(this.editBoxData.RolesForStaff.forEach(function(t){!1===t.IsMatron&&!1===t.IsDefaultNurse&&(a.push(t.JobAndCompetence),i.push("您配置的科室还没有添加权限！请至少配置一个权限！"))}),this.GLOBAL.VerificationHandle([{val:a,type:"ArrayAllNotEmpty",msg:i}])){for(var o=[],n=[],s=[],l=[],c=0;c<this.editBoxData.RolesForStaff.length;c++)for(var r=0;r<this.editBoxData.RolesForStaff[c].JobAndCompetence.length;r++)o.push(this.editBoxData.RolesForStaff[c].JobAndCompetence[r].RoleJob),n.push(this.editBoxData.RolesForStaff[c].JobAndCompetence[r].Competence),s.push("科室权限组的岗位不能为空！"),l.push("科室权限组的职位不能为空！");this.GLOBAL.VerificationHandle([{val:o,type:"StringAllNotEmpty",msg:s},{val:n,type:"StringAllNotEmpty",msg:l}])&&axios({url:"/api/Staff",method:e,data:this.editBoxData}).then(function(e){var a;200==e.data.Code?(a="success",t.$emit("to-father",e.data.Data)):a=300==e.data.Code?"warning":"error",t.showInformation({classify:"message",msg:e.data.Msg,type:a})}).catch(function(t){})}}}}},c=l,r=(a("590e"),a("2877")),d=Object(r["a"])(c,n,s,!1,null,null,null),f=d.exports,u=a("58d7"),h=a("1146"),p=a.n(h),m={data:function(){return{isShowBarCodeList:!1,basic_search:"",table_data:[],showEditBox:!1,toChildData:{}}},components:{StaffBox:f,PrintBarCodeList:u["a"]},created:function(){var t=this;axios({url:"/odata/Staffs"}).then(function(e){t.table_data=e.data.value}).catch(function(t){})},mounted:function(){},methods:{fileChange:function(t){var e=this,a={},i=t.target.files[0],o=new FileReader;o.onload=function(t){var i=t.target.result,o=p.a.read(i,{type:"binary"});o.SheetNames.forEach(function(t){a[t]=p.a.utils.sheet_to_row_object_array(o.Sheets[t]).splice(1)});for(var n=function(t){a.Sheet1[t].RolesForStaff=a.RolesForStaff.filter(function(e){return e.Id===a.Sheet1[t].Id})},s=0;s<a.Sheet1.length;s++)n(s);e.requestData(a.Sheet1,0)},o.onerror=function(t){this.showInformation({classify:"message",msg:"文件不能被读取！Code ".concat(t.target.error.code)})},o.readAsBinaryString(i)},requestData:function(t,e){var a=this;axios({url:"/api/Staff",method:"POST",data:t[e]}).then(function(i){200==i.data.Code?(a.table_data=i.data.Data,e<t.length-1&&a.requestData(t,e+1)):a.showInformation({classify:"message",msg:i.data.Msg})}).catch(function(t){})},barCodeListToFather:function(){this.isShowBarCodeList=!1},handlePrint:function(){this.isShowBarCodeList=!0},searchThisTableData:function(){this.baseDataSearch("/odata/staffs?$filter=contains(name,".concat("'"+this.basic_search+"'",")"))},addTableTr:function(){this.toChildData={Id:0,Name:"",JobNumber:"",BarCode:"",Password:"",RolesForStaff:[]},this.showEditBox=!0},deleteThisTr:function(t){var e=this;this.$confirm("您是否确定删除该项?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(function(){axios.delete("/api/Staff/".concat(e.table_data[t].Id)).then(function(t){var a;200==t.data.Code?(a="success",e.table_data=t.data.Data):a="error",e.showInformation({classify:"message",msg:t.data.Msg,type:a})}).catch(function(t){})}).catch(function(){})},editThisTr:function(t){this.toChildData=JSON.parse(JSON.stringify(this.table_data[t])),this.showEditBox=!0},child2father:function(t){this.showEditBox=!1,t&&(this.table_data=t)}}},b=m,C=Object(r["a"])(b,i,o,!1,null,null,null);e["default"]=C.exports}}]);